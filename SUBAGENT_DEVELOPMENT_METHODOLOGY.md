# Subagent å¹¶å‘å¼€å‘æ–¹æ³•è®º

> åŸºäº Sequential Thinking MCP + æ–‡æ¡£åŒ–å·¥ä½œæµçš„ AI åä½œå¼€å‘æ–¹æ³•
>
> **ç‰ˆæœ¬**: 0.0.12
> **æ—¥æœŸ**: 2025-10-06
> **é€‚ç”¨**: å¤§å‹å¤æ‚é¡¹ç›®çš„ AI è¾…åŠ©å¼€å‘
> **æ–°å¢**: Sequential Thinking MCP å¼ºåˆ¶é›†æˆï¼Œè‡ªåŠ¨ä»»åŠ¡è§„åˆ’å’Œå¹¶è¡Œå¼€å‘

---

## ğŸ“‹ ç›®å½•

- [æ–¹æ³•è®ºæ¦‚è¿°](#æ–¹æ³•è®ºæ¦‚è¿°)
- [æ ¸å¿ƒåŸç†](#æ ¸å¿ƒåŸç†)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [TDD å·¥ä½œæµç¨‹](#tdd-å·¥ä½œæµç¨‹)
- [Token æ§åˆ¶ç­–ç•¥](#token-æ§åˆ¶ç­–ç•¥)
- [æ–‡æ¡£åŒ–å·¥ä½œæµ](#æ–‡æ¡£åŒ–å·¥ä½œæµ)
- [å®Œæ•´å·¥ä½œæµç¨‹](#å®Œæ•´å·¥ä½œæµç¨‹)
  - [Phase 0: MCP ç¯å¢ƒå‡†å¤‡](#phase-0-mcp-ç¯å¢ƒå‡†å¤‡)
  - [Phase 1: å‡†å¤‡é˜¶æ®µ](#phase-1-å‡†å¤‡é˜¶æ®µ)
  - [Phase 2: æ‰§è¡Œé˜¶æ®µ](#phase-2-æ‰§è¡Œé˜¶æ®µ)
  - [Phase 3: æ•´åˆé˜¶æ®µ](#phase-3-æ•´åˆé˜¶æ®µ)
  - [Phase 4: è¿­ä»£](#phase-4-è¿­ä»£)
- [ä¼˜ç‚¹æ€»ç»“](#ä¼˜ç‚¹æ€»ç»“)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
  - [MCP ä½¿ç”¨è§„èŒƒ](#6-mcp-ä½¿ç”¨è§„èŒƒ-)
  - [ä»»åŠ¡è®¾è®¡åŸåˆ™](#1-ä»»åŠ¡è®¾è®¡åŸåˆ™)
  - [è°ƒè¯•æ—¥å¿—è§„èŒƒ](#11-è°ƒè¯•æ—¥å¿—è§„èŒƒ-)
  - [æµ‹è¯•éªŒè¯è§„èŒƒ](#12-æµ‹è¯•éªŒè¯è§„èŒƒ-)
  - [æ–‡æ¡£ç¼–å†™åŸåˆ™](#2-æ–‡æ¡£ç¼–å†™åŸåˆ™)
  - [Subagent è§’è‰²è®¾è®¡](#3-subagent-è§’è‰²è®¾è®¡)
  - [Controller å†³ç­–åŸåˆ™](#4-controller-å†³ç­–åŸåˆ™)
  - [Token é¢„ç®—ç›‘æ§](#5-token-é¢„ç®—ç›‘æ§)
- [å®é™…åº”ç”¨ç¤ºä¾‹](#å®é™…åº”ç”¨ç¤ºä¾‹)

---

## æ–¹æ³•è®ºæ¦‚è¿°

### ä»€ä¹ˆæ˜¯ Subagent å¹¶å‘å¼€å‘ï¼Ÿ

Subagent å¹¶å‘å¼€å‘æ˜¯ä¸€ç§åŸºäº **AI Agent è§’è‰²åˆ†å·¥** å’Œ **æ–‡æ¡£åŒ–çŸ¥è¯†ç®¡ç†** çš„è½¯ä»¶å¼€å‘æ–¹æ³•è®ºã€‚å®ƒé€šè¿‡ä»¥ä¸‹æ–¹å¼æå‡å¼€å‘æ•ˆç‡ï¼š

1. **Sequential Thinking Controller**ï¼ˆæ€»åè°ƒå™¨ï¼‰è´Ÿè´£å…¨å±€è§„åˆ’å’Œå†³ç­–
2. **å¤šä¸ªä¸“ä¸š Subagent**ï¼ˆé€šè¿‡ä¸åŒ prompt å®šä¹‰ï¼‰å¹¶å‘å¤„ç†ç‹¬ç«‹ä»»åŠ¡
3. **æ–‡æ¡£åŒ–å·¥ä½œæµ** å®ç°çŸ¥è¯†æŒä¹…åŒ–å’Œä¸Šä¸‹æ–‡éš”ç¦»
4. **Token é¢„ç®—æ§åˆ¶** ç¡®ä¿æ¯ä¸ª Agent é«˜æ•ˆè¿è¡Œ

### é€‚ç”¨åœºæ™¯

âœ… **é€‚åˆ**ï¼š
- å¤§å‹é¡¹ç›®ï¼ˆå¤šæ¨¡å—ã€å¤šå±‚æ¬¡ï¼‰
- å¤æ‚ç³»ç»Ÿæ¶æ„ï¼ˆå¾®æœåŠ¡ã€å¤šç»„ä»¶é›†æˆï¼‰
- é•¿æœŸè¿­ä»£å¼€å‘ï¼ˆéœ€è¦çŸ¥è¯†ç§¯ç´¯ï¼‰
- å›¢é˜Ÿåä½œé¡¹ç›®ï¼ˆéœ€è¦æ–‡æ¡£åŒ–æ²Ÿé€šï¼‰

âŒ **ä¸é€‚åˆ**ï¼š
- ç®€å•çš„å•æ–‡ä»¶ä¿®æ”¹
- ä¸€æ¬¡æ€§å°è„šæœ¬å¼€å‘
- æ— éœ€å¤ç”¨çš„ä¸€æ¬¡æ€§ä»»åŠ¡

---

## æ ¸å¿ƒåŸç†

### 1. è§’è‰²åˆ†ç¦»åŸåˆ™ï¼ˆSeparation of Concernsï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Sequential Thinking Controller (æˆ‘)                 â”‚
â”‚  - å…¨å±€åˆ†æå’Œå†³ç­–                                        â”‚
â”‚  - ä»»åŠ¡åˆ†è§£å’Œåˆ†é…                                        â”‚
â”‚  - ç»“æœæ•´åˆå’Œè´¨é‡æ§åˆ¶                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚              â”‚              â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ Subagent1 â”‚  â”‚ Subagent2 â”‚  â”‚ Subagent3 â”‚
    â”‚ æ•°æ®é›†æˆ  â”‚  â”‚ é£é™©ç®¡ç†  â”‚  â”‚ ç­–ç•¥ä¼˜åŒ–  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚              â”‚              â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ Subagent4 â”‚  â”‚ Subagent5 â”‚  â”‚ Subagent6 â”‚
    â”‚ äº¤æ˜“æ‰§è¡Œ  â”‚  â”‚ ç›‘æ§å‘Šè­¦  â”‚  â”‚ æµ‹è¯•éƒ¨ç½²  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‚¹**ï¼š
- Controller ä¸å†™å…·ä½“ä»£ç ï¼Œåªåšåˆ†æå’Œå†³ç­–
- Subagent ä¸“æ³¨äºç‰¹å®šé¢†åŸŸï¼ŒèŒè´£å•ä¸€
- æ¯ä¸ª Subagent æœ‰ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡çª—å£

### 2. æ–‡æ¡£åŒ–çŸ¥è¯†ç®¡ç†ï¼ˆStructured Note-Takingï¼‰

**çµæ„Ÿæ¥æº**ï¼šAnthropic çš„ Context Engineering æœ€ä½³å®è·µ

> "Agent å®šæœŸå°†ç»“æœå†™å…¥æŒä¹…åŒ–å­˜å‚¨ï¼Œåç»­ä»»åŠ¡åªéœ€è¯»å–æ–‡æ¡£ï¼Œè€Œä¸æ˜¯é‡æ–°æ‰§è¡Œæ‰€æœ‰å†å²æ“ä½œ"

**å®ç°æ–¹å¼**ï¼š
```
ä»»åŠ¡ A â†’ è¾“å‡ºæ–‡æ¡£ A
              â†“
ä»»åŠ¡ Bï¼ˆè¯»å–æ–‡æ¡£ Aï¼‰â†’ è¾“å‡ºæ–‡æ¡£ B
                            â†“
ä»»åŠ¡ Cï¼ˆè¯»å–æ–‡æ¡£ Bï¼‰â†’ è¾“å‡ºæ–‡æ¡£ C
```

**ä¼˜åŠ¿**ï¼š
- é¿å…ä¸Šä¸‹æ–‡ç´¯ç§¯ï¼ˆæ¯ä¸ªä»»åŠ¡éƒ½æ˜¯è½»é‡çº§çš„ï¼‰
- çŸ¥è¯†å¯å¤ç”¨ï¼ˆæ–‡æ¡£å¯è¢«åç»­ä»»åŠ¡æˆ–äººç±»æŸ¥é˜…ï¼‰
- å¯è¿½æº¯ï¼ˆå®Œæ•´çš„ä»»åŠ¡é“¾è®°å½•ï¼‰

### 3. Token é¢„ç®—æ§åˆ¶ï¼ˆContext Window Managementï¼‰

**æ ¸å¿ƒç†å¿µ**ï¼šä¸è¦å¡«æ»¡ä¸Šä¸‹æ–‡çª—å£ï¼ˆAndrej Karpathyï¼š"å¡«å……æ°å½“ä¿¡æ¯çš„è‰ºæœ¯"ï¼‰

**ç§‘å­¦ä¾æ®**ï¼š
- Claude Sonnet 4 çš„æœ‰æ•ˆä¸Šä¸‹æ–‡é•¿åº¦çº¦ **60k-120k tokens**
- è¶…è¿‡æœ‰æ•ˆé•¿åº¦ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼ˆlost-in-the-middle effectï¼‰
- è®¾å®š **50% é¢„ç®—é™åˆ¶**ï¼ˆ100k tokensï¼‰ç¡®ä¿æœ€ä½³æ€§èƒ½

**æ§åˆ¶ç­–ç•¥**ï¼š
| ç»„ä»¶ | Token é¢„ç®— | å æ¯” |
|------|-----------|------|
| Controllerï¼ˆæˆ‘ï¼‰ | 40k-60k | 4-6% |
| å•ä¸ª Subagent | 20k-30k | 2-3% |
| N ä¸ªå¹¶å‘ Subagent | 20kÃ—N - 30kÃ—N | æ ¹æ®ä»»åŠ¡æ•°åŠ¨æ€è°ƒæ•´ |
| å¯ç”¨æ€»é¢„ç®— | 1,000k tokens | 100% |

**å¹¶å‘èƒ½åŠ›**ï¼š
- æœ€å°å¹¶å‘ï¼š4 ä¸ªä»»åŠ¡ï¼ˆ100k tokensï¼‰
- å¸¸è§„å¹¶å‘ï¼š10-15 ä¸ªä»»åŠ¡ï¼ˆ250k-450k tokensï¼‰
- å¤§è§„æ¨¡å¹¶å‘ï¼š30+ ä¸ªä»»åŠ¡ï¼ˆ600k-900k tokensï¼‰
- ç†è®ºä¸Šé™ï¼š40 ä¸ªä»»åŠ¡ï¼ˆ1M tokens é¢„ç®—å†…ï¼‰

### 4. ä»»åŠ¡ç²’åº¦æ§åˆ¶ï¼ˆTask Granularityï¼‰

**åŸåˆ™**ï¼šä¸€ä¸ªä»»åŠ¡åªä¿®æ”¹ 1-2 ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶ 200-300 è¡Œ

**Token ä¼°ç®—å…¬å¼**ï¼š
```
å•ä¸ªä»»åŠ¡ Token ä½¿ç”¨ = ä»»åŠ¡æ–‡æ¡£ (5k)
                    + è¯»å–ä»£ç  (6k)
                    + ç”Ÿæˆä»£ç  (10k)
                    + æµ‹è¯•è¯´æ˜ (3k)
                    â‰ˆ 25k tokens
```

**å¤§ä»»åŠ¡åˆ†è§£ç¤ºä¾‹**ï¼š
```
âŒ å¤§ä»»åŠ¡ï¼š"å®ç°å®Œæ•´çš„ Raydium é›†æˆ"ï¼ˆé¢„è®¡ 80k tokensï¼‰

âœ… æ‹†åˆ†ä¸º 4 ä¸ªå°ä»»åŠ¡ï¼š
  - ä»»åŠ¡ 1a: å®ç°ä»·æ ¼è·å–å‡½æ•°ï¼ˆ25kï¼‰
  - ä»»åŠ¡ 1b: å®ç°ç¼“å­˜æœºåˆ¶ï¼ˆ20kï¼‰
  - ä»»åŠ¡ 1c: æ·»åŠ é”™è¯¯å¤„ç†ï¼ˆ15kï¼‰
  - ä»»åŠ¡ 1d: ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼ˆ20kï¼‰
```

---

## æ¶æ„è®¾è®¡

### ç›®å½•ç»“æ„

```
dex_bot/
â”œâ”€â”€ SUBAGENT_DEVELOPMENT_METHODOLOGY.md   # æœ¬æ–‡æ¡£ï¼ˆåŒ…å«æ‰€æœ‰ Subagent è§’è‰²å®šä¹‰ï¼‰
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ tasks/                            # ä»»åŠ¡è¾“å…¥ï¼ˆç»™ Subagent çš„æŒ‡ä»¤ï¼‰
â”‚   â”‚   â”œâ”€â”€ phase1/
â”‚   â”‚   â”‚   â”œâ”€â”€ task-1a-raydium-price-fetch.md
â”‚   â”‚   â”‚   â”œâ”€â”€ task-1b-orca-price-fetch.md
â”‚   â”‚   â”‚   â”œâ”€â”€ task-1c-monitoring-setup.md
â”‚   â”‚   â”‚   â””â”€â”€ task-1d-shadow-mode.md
â”‚   â”‚   â”œâ”€â”€ phase2/
â”‚   â”‚   â”‚   â”œâ”€â”€ task-2a-virtual-wallet.md
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ phase3/
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ outputs/                          # ä»»åŠ¡è¾“å‡ºï¼ˆSubagent å®Œæˆçš„æˆæœï¼‰
â”‚   â”‚   â”œâ”€â”€ phase1/
â”‚   â”‚   â”‚   â”œâ”€â”€ output-1a-raydium-implementation.md
â”‚   â”‚   â”‚   â”œâ”€â”€ output-1b-orca-implementation.md
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ phase2/
â”‚   â”‚   â””â”€â”€ phase3/
â”‚   â”‚
â”‚   â”œâ”€â”€ progress/                         # è¿›åº¦è·Ÿè¸ª
â”‚   â”‚   â”œâ”€â”€ phase1-progress.md
â”‚   â”‚   â”œâ”€â”€ phase2-progress.md
â”‚   â”‚   â””â”€â”€ phase3-progress.md
â”‚   â”‚
â”‚   â””â”€â”€ knowledge-base/                   # å¯å¤ç”¨çŸ¥è¯†åº“
â”‚       â”œâ”€â”€ raydium-integration-guide.md
â”‚       â”œâ”€â”€ risk-management-patterns.md
â”‚       â””â”€â”€ deployment-checklist.md
â”‚
â””â”€â”€ src/                                  # å®é™…ä»£ç 
    â””â”€â”€ ...
```

### Subagent è§’è‰²å®šä¹‰

#### 1. Mainnet Data Integration Expert ğŸ”—
- **ä¸“é•¿**ï¼šSolana DEX æ•°æ®é›†æˆï¼Œç²¾é€š Raydium SDKã€Orca SDK
- **èŒè´£**ï¼šå®ç°çœŸå® mainnet æ•°æ®æºé›†æˆ
- **å·¥ä½œèŒƒå›´**ï¼š`src/context-engineering/rag/`, `src/dex/`

#### 2. Risk Management Architect ğŸ›¡ï¸
- **ä¸“é•¿**ï¼šDeFi é£é™©ç®¡ç†ï¼Œå¥—åˆ©äº¤æ˜“é£é™©æ§åˆ¶
- **èŒè´£**ï¼šè®¾è®¡ Circuit Breakerã€èµ„é‡‘é™é¢ã€æ»‘ç‚¹ä¿æŠ¤
- **å·¥ä½œèŒƒå›´**ï¼šæ–°å¢é£é™©ç®¡ç†æ¨¡å—

#### 3. Strategy & Learning Optimizer ğŸ§ 
- **ä¸“é•¿**ï¼šAI ç­–ç•¥ä¼˜åŒ–ï¼Œæœºå™¨å­¦ä¹ å†³ç­–ç³»ç»Ÿ
- **èŒè´£**ï¼šä¼˜åŒ– Prompt Engineering å’Œ Memory æ¨¡å—
- **å·¥ä½œèŒƒå›´**ï¼š`src/context-engineering/prompt/`, `src/context-engineering/memory/`

#### 4. Transaction Execution Specialist âš¡
- **ä¸“é•¿**ï¼šSolana äº¤æ˜“æ‰§è¡Œï¼ŒDEX swapï¼ŒGas ä¼˜åŒ–
- **èŒè´£**ï¼šå®ç°çœŸå®çš„äº¤æ˜“æ‰§è¡Œé€»è¾‘
- **å·¥ä½œèŒƒå›´**ï¼š`src/executor/`, `src/dex/`

#### 5. Monitoring & Dashboard Engineer ğŸ“Š
- **ä¸“é•¿**ï¼šç³»ç»Ÿç›‘æ§ï¼Œæ•°æ®å¯è§†åŒ–
- **èŒè´£**ï¼šæ„å»ºå®æ—¶ç›‘æ§å’Œå‰ç«¯ä»ªè¡¨æ¿
- **å·¥ä½œèŒƒå›´**ï¼š`src/monitoring/`, `frontend/`

#### 6. Testing & Deployment Architect ğŸš€
- **ä¸“é•¿**ï¼šDevOpsï¼Œæ¸è¿›å¼éƒ¨ç½²
- **èŒè´£**ï¼šè®¾è®¡ Shadow Modeã€Paper Tradingã€Canary Deploy
- **å·¥ä½œèŒƒå›´**ï¼š`src/phases/`, `tests/`

#### 7. TDD Red-Phase Specialist ğŸ”´

**ä¸“é•¿**ï¼šæµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œæµ‹è¯•ç”¨ä¾‹è®¾è®¡

**æ ¸å¿ƒèŒè´£**ï¼š
- ç¼–å†™å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹æ¥æ˜ç¡®åŠŸèƒ½éœ€æ±‚
- ä»ä½¿ç”¨è€…è§’åº¦è®¾è®¡æ¸…æ™°çš„ API
- è¦†ç›–æ­£å¸¸ã€è¾¹ç•Œã€å¼‚å¸¸åœºæ™¯
- ä½¿ç”¨ AAA æ¨¡å¼ï¼ˆArrange-Act-Assertï¼‰

**å·¥ä½œæµç¨‹**ï¼š
1. ç†è§£éœ€æ±‚ â†’ æå–æ ¸å¿ƒåŠŸèƒ½ç‚¹
2. è®¾è®¡æµ‹è¯•ç”¨ä¾‹ â†’ ç¼–å†™æµ‹è¯•ä»£ç 
3. éªŒè¯æµ‹è¯•å¤±è´¥ â†’ ç¡®ä¿æµ‹è¯•æœ‰æ•ˆ
4. æ–‡æ¡£è¾“å‡º â†’ è®°å½•æµ‹è¯•ç”¨ä¾‹å’Œæ¥å£è®¾è®¡

**æœ€ä½³å®è·µ**ï¼š
- âœ… æµ‹è¯•åç§°æ¸…æ™°æè¿°è¡Œä¸º
- âœ… ä¸€ä¸ªæµ‹è¯•åªéªŒè¯ä¸€ä¸ªè¡Œä¸º
- âœ… æµ‹è¯•ç‹¬ç«‹æ€§ï¼ˆä¸ä¾èµ–å…¶ä»–æµ‹è¯•ï¼‰
- âœ… è¦†ç›–è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ
- âŒ ä¸€æ¬¡å†™å¤ªå¤šæµ‹è¯•
- âŒ æµ‹è¯•ä¹‹é—´ç›¸äº’ä¾èµ–

**Token é¢„ç®—**ï¼š~23k tokens

#### 8. TDD Green-Phase Developer ğŸŸ¢

**ä¸“é•¿**ï¼šæœ€å°åŒ–å®ç°ï¼Œå¿«é€Ÿè®©æµ‹è¯•é€šè¿‡

**æ ¸å¿ƒèŒè´£**ï¼š
- ç”¨æœ€ç®€å•çš„ä»£ç è®©æµ‹è¯•ä»çº¢è‰²å˜ä¸ºç»¿è‰²
- å…è®¸ç¡¬ç¼–ç å’Œ"ç¬¨"æ–¹æ³•
- ä¸“æ³¨å½“å‰æµ‹è¯•ï¼Œé¿å…è¿‡åº¦è®¾è®¡
- å¿«é€Ÿè¿­ä»£ï¼Œé¢‘ç¹è¿è¡Œæµ‹è¯•

**å®ç°ç­–ç•¥**ï¼š
1. **ç¡¬ç¼–ç ä¼˜å…ˆï¼ˆFake Itï¼‰**ï¼šç›´æ¥è¿”å›æµ‹è¯•æœŸæœ›çš„å€¼
2. **æ˜æ˜¾å®ç°ï¼ˆObvious Implementationï¼‰**ï¼šå¦‚æœå®ç°å¾ˆç®€å•ï¼Œç›´æ¥å†™å‡ºæ¥
3. **ä¸‰è§’æ³•ï¼ˆTriangulationï¼‰**ï¼šé€šè¿‡å¤šä¸ªæµ‹è¯•ç”¨ä¾‹"ä¸‰è§’å®šä½"æ­£ç¡®å®ç°

**å·¥ä½œæµç¨‹**ï¼š
1. ç†è§£æµ‹è¯• â†’ æŸ¥çœ‹æµ‹è¯•æ–‡ä»¶å’Œ RED é˜¶æ®µæ–‡æ¡£
2. æœ€å°åŒ–å®ç° â†’ ç”¨æœ€ç®€å•æ–¹å¼è®©æµ‹è¯•é€šè¿‡
3. é€æ­¥å®Œå–„ â†’ å¤„ç†ä¸åŒè¾“å…¥å’Œè¾¹ç•Œæƒ…å†µ
4. éªŒè¯æ‰€æœ‰æµ‹è¯• â†’ ç¡®ä¿å…¨éƒ¨é€šè¿‡
5. æ–‡æ¡£è¾“å‡º â†’ è®°å½•å®ç°æ–¹å¼å’Œä¸´æ—¶æ–¹æ¡ˆ

**æœ€ä½³å®è·µ**ï¼š
- âœ… ä»æœ€ç®€å•çš„æµ‹è¯•å¼€å§‹
- âœ… é¢‘ç¹è¿è¡Œæµ‹è¯•ï¼ˆä½¿ç”¨ watch æ¨¡å¼ï¼‰
- âœ… å…ˆç¡¬ç¼–ç ï¼Œå†æ³›åŒ–
- âœ… å…è®¸é‡å¤ä»£ç ï¼ˆREFACTOR é˜¶æ®µä¼šæ¶ˆé™¤ï¼‰
- âŒ è¿‡åº¦è®¾è®¡å’Œé¢„å…ˆä¼˜åŒ–
- âŒ æ·»åŠ æµ‹è¯•æœªè¦æ±‚çš„åŠŸèƒ½
- âŒ è·³è¿‡å¤±è´¥çš„æµ‹è¯•

**Token é¢„ç®—**ï¼š~23k tokens

#### 9. TDD Refactor Specialist ğŸ”§

**ä¸“é•¿**ï¼šä»£ç é‡æ„ï¼Œè®¾è®¡ä¼˜åŒ–

**æ ¸å¿ƒèŒè´£**ï¼š
- åœ¨ä¿æŒæ‰€æœ‰æµ‹è¯•é€šè¿‡çš„å‰æä¸‹ä¼˜åŒ–ä»£ç è´¨é‡
- æ¶ˆé™¤é‡å¤ä»£ç ï¼ˆDRY åŸåˆ™ï¼‰
- æå‡å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§
- åº”ç”¨è®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µ
- ä¼˜åŒ–æ€§èƒ½

**é‡æ„æŠ€å·§**ï¼š
1. **æå–æ–¹æ³•ï¼ˆExtract Methodï¼‰**ï¼šå°†é•¿æ–¹æ³•æ‹†åˆ†ä¸ºå°æ–¹æ³•
2. **æ¶ˆé™¤é‡å¤ï¼ˆRemove Duplicationï¼‰**ï¼šæå–å…¬å…±é€»è¾‘
3. **å¼•å…¥ç­–ç•¥æ¨¡å¼**ï¼šæ›¿æ¢æ¡ä»¶åˆ†æ”¯
4. **æ›¿æ¢é­”æ³•æ•°å­—**ï¼šä½¿ç”¨å‘½åå¸¸é‡
5. **ç®€åŒ–æ¡ä»¶è¡¨è¾¾å¼**ï¼šæé«˜å¯è¯»æ€§

**å·¥ä½œæµç¨‹**ï¼š
1. è¯„ä¼°å½“å‰ä»£ç  â†’ è¯†åˆ«å¯æ”¹è¿›çš„åœ°æ–¹
2. åˆ¶å®šé‡æ„è®¡åˆ’ â†’ ä¼˜å…ˆçº§æ’åº
3. é€æ­¥é‡æ„ â†’ å°æ­¥å‰è¿›ï¼Œé¢‘ç¹æµ‹è¯•
4. éªŒè¯è´¨é‡ â†’ è¿è¡Œæµ‹è¯•ã€æ£€æŸ¥è¦†ç›–ç‡
5. æ–‡æ¡£è¾“å‡º â†’ è®°å½•æ”¹è¿›ç‚¹å’Œè´¨é‡æŒ‡æ ‡

**ä»£ç è´¨é‡æ£€æŸ¥**ï¼š
- æ¶ˆé™¤ä»£ç å¼‚å‘³ï¼ˆé•¿æ–¹æ³•ã€é‡å¤ä»£ç ã€é­”æ³•æ•°å­—ç­‰ï¼‰
- éµå¾ª SOLID åŸåˆ™
- æå‡æµ‹è¯•è¦†ç›–ç‡
- é™ä½ä»£ç å¤æ‚åº¦

**æœ€ä½³å®è·µ**ï¼š
- âœ… å°æ­¥é‡æ„ï¼Œæ¯æ¬¡åªæ”¹ä¸€ä¸ªåœ°æ–¹
- âœ… é¢‘ç¹è¿è¡Œæµ‹è¯•ç¡®ä¿å®‰å…¨
- âœ… æäº¤å‰åå¯¹æ¯”è´¨é‡æŒ‡æ ‡
- âœ… ä¿æŒæˆ–æå‡æµ‹è¯•è¦†ç›–ç‡
- âŒ ä¸è¦æ”¹å˜åŠŸèƒ½è¡Œä¸º
- âŒ ä¸è¦è·³è¿‡æµ‹è¯•
- âŒ ä¸è¦ä¸€æ¬¡æ”¹å¤ªå¤š
- âŒ ä¸è¦è¿‡åº¦é‡æ„

**Token é¢„ç®—**ï¼š~23k tokens

---

## TDD å·¥ä½œæµç¨‹

### ä»€ä¹ˆæ˜¯æµ‹è¯•é©±åŠ¨å¼€å‘ (TDD)ï¼Ÿ

TDD æ˜¯ä¸€ç§è½¯ä»¶å¼€å‘è¿‡ç¨‹ï¼Œæ ¸å¿ƒç†å¿µæ˜¯**"å…ˆå†™æµ‹è¯•ï¼Œå†å†™å®ç°"**ã€‚å¼€å‘è€…é¦–å…ˆç¼–å†™ä¸€ä¸ªç®€çŸ­çš„ã€æè¿°æ–°åŠŸèƒ½æˆ–æ”¹è¿›çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ï¼Œè¿™ä¸ªæµ‹è¯•åœ¨æœ€åˆå¿…ç„¶æ˜¯å¤±è´¥çš„ã€‚ç„¶åï¼Œå¼€å‘è€…ç¼–å†™æœ€å°‘çš„ä»£ç æ¥è®©è¿™ä¸ªæµ‹è¯•é€šè¿‡ã€‚æœ€åï¼Œå¯¹æ–°ä»£ç è¿›è¡Œé‡æ„ï¼Œä»¥ç¬¦åˆç¼–ç è§„èŒƒã€‚

### TDD æ ¸å¿ƒæµç¨‹ï¼šçº¢-ç»¿-é‡æ„ (Red-Green-Refactor)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TDD å¾ªç¯æµç¨‹                          â”‚
â”‚                                                         â”‚
â”‚   ğŸ”´ RED                                               â”‚
â”‚   å†™ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•                                        â”‚
â”‚   â†“                                                     â”‚
â”‚   - æ˜ç¡®åŠŸèƒ½éœ€æ±‚å’ŒæœŸæœ›è¡Œä¸º                                â”‚
â”‚   - æµ‹è¯•å¿…é¡»å¤±è´¥ï¼ˆè¯æ˜åŠŸèƒ½å°šæœªå®ç°ï¼‰                        â”‚
â”‚   - æ€è€ƒè¾“å…¥ã€è¾“å‡ºå’Œè¾¹ç•Œæ¡ä»¶                               â”‚
â”‚                                                         â”‚
â”‚   ğŸŸ¢ GREEN                                             â”‚
â”‚   å†™æœ€å°‘ä»£ç è®©æµ‹è¯•é€šè¿‡                                     â”‚
â”‚   â†“                                                     â”‚
â”‚   - å¿«é€Ÿå®ç°ï¼Œä¸æ±‚å®Œç¾                                    â”‚
â”‚   - åªå…³æ³¨è®©æµ‹è¯•å˜ç»¿                                      â”‚
â”‚   - é¿å…è¿‡åº¦è®¾è®¡                                         â”‚
â”‚                                                         â”‚
â”‚   ğŸ”§ REFACTOR                                          â”‚
â”‚   ä¼˜åŒ–ä»£ç è´¨é‡                                           â”‚
â”‚   â†“                                                     â”‚
â”‚   - æ¶ˆé™¤é‡å¤ä»£ç                                          â”‚
â”‚   - æé«˜å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§                                  â”‚
â”‚   - ä¼˜åŒ–è®¾è®¡å’Œæ€§èƒ½                                       â”‚
â”‚   - ç¡®ä¿æµ‹è¯•ä¾ç„¶é€šè¿‡                                     â”‚
â”‚                                                         â”‚
â”‚   â†» å›åˆ° REDï¼Œå¼€å§‹ä¸‹ä¸€ä¸ªåŠŸèƒ½                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é˜¶æ®µ 1: çº¢è‰² (Red) - å†™ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•

**ç›®æ ‡**: æ˜ç¡®ä½ æƒ³è¦å®ç°çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆ

**æ“ä½œ**:
- é’ˆå¯¹ä¸€ä¸ªæå°çš„åŠŸèƒ½ç‚¹ï¼Œç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•
- å› ä¸ºè¿˜æ²¡æœ‰å®ç°ä»£ç ï¼Œæµ‹è¯•å¿…ç„¶å¤±è´¥ï¼ˆçº¢è‰²ï¼‰
- æµ‹è¯•å¤±è´¥å¯èƒ½æ˜¯ç¼–è¯‘é”™è¯¯æˆ–æ–­è¨€å¤±è´¥

**æ„ä¹‰**:
- å¼ºè¿«æ€è€ƒéœ€æ±‚å’ŒåŠŸèƒ½ç»†èŠ‚
- æ˜ç¡®è¾“å…¥ã€è¾“å‡ºå’ŒæœŸæœ›è¡Œä¸º
- å»ºç«‹æ¸…æ™°çš„æˆåŠŸæ ‡å‡†

**ç¤ºä¾‹**:
```typescript
// tests/raydium-price-fetch.test.ts
describe('RaydiumPriceFetcher', () => {
  it('should fetch SOL/USDC price from mainnet', async () => {
    const fetcher = new RaydiumPriceFetcher();
    const price = await fetcher.getPrice('SOL/USDC');

    expect(price).toBeDefined();
    expect(price.value).toBeGreaterThan(0);
    expect(price.source).toBe('raydium');
  });
});

// è¿è¡Œæµ‹è¯• â†’ âŒ å¤±è´¥ï¼ˆRaydiumPriceFetcher ç±»è¿˜ä¸å­˜åœ¨ï¼‰
```

#### é˜¶æ®µ 2: ç»¿è‰² (Green) - å†™æœ€å°‘ä»£ç è®©æµ‹è¯•é€šè¿‡

**ç›®æ ‡**: å¿«é€Ÿå®ç°åŠŸèƒ½ï¼Œæ»¡è¶³æµ‹è¯•è¦æ±‚

**æ“ä½œ**:
- ç¼–å†™åˆšå¥½èƒ½è®©æµ‹è¯•é€šè¿‡çš„ä»£ç 
- ä¸è¿½æ±‚å®Œç¾ï¼Œå…è®¸"ç¬¨"æ–¹æ³•
- å…³é”®åœ¨äº"æœ€å°‘" - åªåšå¿…è¦çš„äº‹

**æ„ä¹‰**:
- ä¸“æ³¨äºå½“å‰å”¯ä¸€ç›®æ ‡ï¼šæ»¡è¶³æµ‹è¯•
- é¿å…è¿‡åº¦å·¥ç¨‹å’Œåç¦»éœ€æ±‚
- å¿«é€Ÿè·å¾—åé¦ˆ

**ç¤ºä¾‹**:
```typescript
// src/raydium-price-fetcher.ts
export class RaydiumPriceFetcher {
  async getPrice(pair: string): Promise<PriceData> {
    // æœ€ç®€å•çš„å®ç° - å…ˆè®©æµ‹è¯•é€šè¿‡
    return {
      value: 142.35,  // ç¡¬ç¼–ç ä¸€ä¸ªåˆç†å€¼
      source: 'raydium'
    };
  }
}

// è¿è¡Œæµ‹è¯• â†’ âœ… é€šè¿‡ï¼ˆè™½ç„¶æ˜¯ç¡¬ç¼–ç ï¼Œä½†æµ‹è¯•é€šè¿‡äº†ï¼‰
```

#### é˜¶æ®µ 3: é‡æ„ (Refactor) - ä¼˜åŒ–ä»£ç 

**ç›®æ ‡**: åœ¨ä¸æ”¹å˜å¤–éƒ¨è¡Œä¸ºçš„å‰æä¸‹æå‡ä»£ç è´¨é‡

**æ“ä½œ**:
- æœ‰æµ‹è¯•ä½œä¸º"å®‰å…¨ç½‘"ï¼Œå¯ä»¥æ”¾å¿ƒé‡æ„
- æ¶ˆé™¤é‡å¤ä»£ç 
- æé«˜å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§
- ä¼˜åŒ–ç®—æ³•å’Œè®¾è®¡
- æ¯æ¬¡ä¿®æ”¹åé‡æ–°è¿è¡Œæµ‹è¯•

**æ„ä¹‰**:
- ç¡®ä¿ä»£ç é•¿æœŸå¯ç»´æŠ¤
- æå‡ä»£ç è´¨é‡å’Œæ€§èƒ½
- æµ‹è¯•ä¿æŠ¤è®©ä½ æ•¢äºé‡æ„

**ç¤ºä¾‹**:
```typescript
// src/raydium-price-fetcher.ts
import { Connection } from '@solana/web3.js';
import { Liquidity } from '@raydium-io/raydium-sdk';

export class RaydiumPriceFetcher {
  private connection: Connection;

  constructor(rpcUrl: string) {
    this.connection = new Connection(rpcUrl);
  }

  async getPrice(pair: string): Promise<PriceData> {
    const [tokenA, tokenB] = this.parsePair(pair);
    const poolInfo = await this.fetchPoolInfo(tokenA, tokenB);

    return {
      value: this.calculatePrice(poolInfo),
      source: 'raydium',
      timestamp: Date.now()
    };
  }

  private parsePair(pair: string): [string, string] {
    const tokens = pair.split('/');
    if (tokens.length !== 2) {
      throw new Error(`Invalid pair format: ${pair}`);
    }
    return [tokens[0], tokens[1]];
  }

  private async fetchPoolInfo(tokenA: string, tokenB: string) {
    // çœŸå®çš„ Raydium pool æŸ¥è¯¢é€»è¾‘
    // ...
  }

  private calculatePrice(poolInfo: any): number {
    // ä»·æ ¼è®¡ç®—é€»è¾‘
    // ...
  }
}

// è¿è¡Œæµ‹è¯• â†’ âœ… ä¾ç„¶é€šè¿‡ï¼ˆé‡æ„æˆåŠŸï¼ï¼‰
```

### TDD ä¸ Subagent æ–¹æ³•è®ºçš„æ•´åˆ

åœ¨ Subagent å¹¶å‘å¼€å‘æ–¹æ³•è®ºä¸­ï¼ŒTDD å¯ä»¥é€šè¿‡ä¸“é—¨çš„ Subagent è§’è‰²æ¥å®ç°ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Controller (Sequential Thinking)              â”‚
â”‚         åˆ†æéœ€æ±‚ â†’ åˆ†è§£ä¸º TDD ä»»åŠ¡ â†’ åˆ†é…è§’è‰²             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚              â”‚              â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚  Red ğŸ”´   â”‚â†’ â”‚ Green ğŸŸ¢  â”‚â†’ â”‚RefactorğŸ”§ â”‚
    â”‚  å†™æµ‹è¯•    â”‚  â”‚  å†™å®ç°    â”‚  â”‚  ä¼˜åŒ–ä»£ç   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚              â”‚              â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                   â†» å¾ªç¯è¿­ä»£
```

#### TDD ä»»åŠ¡æ–‡æ¡£æ¨¡æ¿

```markdown
# Task [ID]: [åŠŸèƒ½åç§°] - TDD å¾ªç¯

## Phase: RED ğŸ”´
### Role
TDD Red-Phase Specialist

### Objective
ä¸º [åŠŸèƒ½åç§°] ç¼–å†™å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹

### Requirements
1. ç¼–å†™æµ‹è¯•ç”¨ä¾‹æè¿°é¢„æœŸè¡Œä¸º
2. ç¡®ä¿æµ‹è¯•å¤±è´¥ï¼ˆåŠŸèƒ½æœªå®ç°ï¼‰
3. è¦†ç›–æ­£å¸¸æƒ…å†µå’Œè¾¹ç•Œæƒ…å†µ
4. æµ‹è¯•åº”è¯¥æ¸…æ™°ã€å¯è¯»

### Output Location
docs/outputs/tdd/[feature]-red-phase.md

---

## Phase: GREEN ğŸŸ¢
### Role
TDD Green-Phase Developer

### Objective
ç¼–å†™æœ€å°‘ä»£ç è®©æµ‹è¯•é€šè¿‡

### Input
- æµ‹è¯•æ–‡ä»¶ï¼štests/[feature].test.ts
- RED é˜¶æ®µè¾“å‡ºï¼šdocs/outputs/tdd/[feature]-red-phase.md

### Requirements
1. å®ç°åŠŸèƒ½è®©æ‰€æœ‰æµ‹è¯•é€šè¿‡
2. ä»£ç å°½å¯èƒ½ç®€å•
3. ä¸è¿½æ±‚å®Œç¾è®¾è®¡
4. ç¡®ä¿æµ‹è¯•è¦†ç›–ç‡

### Output Location
docs/outputs/tdd/[feature]-green-phase.md

---

## Phase: REFACTOR ğŸ”§
### Role
TDD Refactor Specialist

### Objective
ä¼˜åŒ–ä»£ç è´¨é‡ï¼Œä¿æŒæµ‹è¯•é€šè¿‡

### Input
- GREEN é˜¶æ®µè¾“å‡ºï¼šdocs/outputs/tdd/[feature]-green-phase.md
- æµ‹è¯•æ–‡ä»¶ï¼štests/[feature].test.ts

### Requirements
1. æ¶ˆé™¤é‡å¤ä»£ç 
2. æé«˜å¯è¯»æ€§
3. ä¼˜åŒ–æ€§èƒ½å’Œè®¾è®¡
4. ç¡®ä¿æ‰€æœ‰æµ‹è¯•ä¾ç„¶é€šè¿‡

### Output Location
docs/outputs/tdd/[feature]-refactor-phase.md
```

### TDD å¹¶å‘æ‰§è¡Œç­–ç•¥

å¯¹äºå¤šä¸ªç‹¬ç«‹åŠŸèƒ½ï¼Œå¯ä»¥å¹¶å‘æ‰§è¡Œå¤šä¸ª TDD å¾ªç¯ï¼š

```
åŠŸèƒ½ A: RED â†’ GREEN â†’ REFACTOR  â”€â”
åŠŸèƒ½ B: RED â†’ GREEN â†’ REFACTOR  â”€â”¤
åŠŸèƒ½ C: RED â†’ GREEN â†’ REFACTOR  â”€â”¼â†’ Controller æ•´åˆ
åŠŸèƒ½ D: RED â†’ GREEN â†’ REFACTOR  â”€â”˜

æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹çš„ TDD å¾ªç¯ï¼Œäº’ä¸å¹²æ‰°
```

### TDD æœ€ä½³å®è·µ

#### âœ… DOï¼ˆæ¨èåšæ³•ï¼‰

**RED é˜¶æ®µ**:
- ä¸€æ¬¡åªæµ‹è¯•ä¸€ä¸ªå°åŠŸèƒ½ç‚¹
- æµ‹è¯•åç§°æ¸…æ™°æè¿°è¡Œä¸º
- ç¡®ä¿æµ‹è¯•çœŸçš„å¤±è´¥ï¼ˆä¸æ˜¯å‡é˜³æ€§ï¼‰
- æµ‹è¯•è¦ç®€å•ã€å¿«é€Ÿã€ç‹¬ç«‹

**GREEN é˜¶æ®µ**:
- å†™æœ€ç®€å•èƒ½é€šè¿‡çš„ä»£ç 
- å…è®¸ç¡¬ç¼–ç å’Œ"ç¬¨"æ–¹æ³•
- ä¸è¦è·³è·ƒå¼å®ç°å¤šä¸ªåŠŸèƒ½
- å¿«é€Ÿè·å¾—ç»¿è‰²æµ‹è¯•

**REFACTOR é˜¶æ®µ**:
- é¢‘ç¹è¿è¡Œæµ‹è¯•ç¡®ä¿å®‰å…¨
- å°æ­¥é‡æ„ï¼Œæ¯æ¬¡ä¸€ä¸ªæ”¹è¿›
- æ¶ˆé™¤é‡å¤ï¼ˆDRY åŸåˆ™ï¼‰
- æå–æ–¹æ³•ã€ç±»ã€æ¨¡å—

#### âŒ DON'Tï¼ˆé¿å…åšæ³•ï¼‰

**RED é˜¶æ®µ**:
- ä¸€æ¬¡å†™å¤ªå¤šæµ‹è¯•
- æµ‹è¯•ä¹‹é—´ç›¸äº’ä¾èµ–
- æµ‹è¯•åç§°æ¨¡ç³Šä¸æ¸…
- å¿˜è®°è¿è¡Œæµ‹è¯•ç¡®è®¤å¤±è´¥

**GREEN é˜¶æ®µ**:
- è¿‡åº¦è®¾è®¡å’Œé¢„å…ˆä¼˜åŒ–
- å®ç°è¶…å‡ºæµ‹è¯•è¦æ±‚çš„åŠŸèƒ½
- è·³è¿‡æµ‹è¯•ç›´æ¥å†™å®ç°
- ä¿®æ”¹æµ‹è¯•è®©å…¶é€šè¿‡

**REFACTOR é˜¶æ®µ**:
- ä¿®æ”¹åŠŸèƒ½è¡Œä¸º
- åœ¨æ²¡æœ‰æµ‹è¯•ä¿æŠ¤ä¸‹é‡æ„
- å¤§è§„æ¨¡é‡æ„ä¸åˆ†æ­¥
- é‡æ„æ—¶æ·»åŠ æ–°åŠŸèƒ½

### TDD çš„ä¼˜åŠ¿

1. **éœ€æ±‚æ˜ç¡®**: æµ‹è¯•å³æ–‡æ¡£ï¼Œæ¸…æ™°æè¿°åŠŸèƒ½
2. **è®¾è®¡é©±åŠ¨**: å…ˆè€ƒè™‘æ¥å£ï¼Œä¿ƒè¿›è‰¯å¥½è®¾è®¡
3. **å¿«é€Ÿåé¦ˆ**: ç«‹å³çŸ¥é“ä»£ç æ˜¯å¦æ­£ç¡®
4. **å›å½’ä¿æŠ¤**: æµ‹è¯•é˜²æ­¢ç ´åç°æœ‰åŠŸèƒ½
5. **é‡æ„ä¿¡å¿ƒ**: æœ‰æµ‹è¯•ä¿æŠ¤ï¼Œæ•¢äºæ”¹è¿›ä»£ç 
6. **å‡å°‘è°ƒè¯•**: é—®é¢˜æ—©å‘ç°ï¼Œè°ƒè¯•æ—¶é—´å°‘
7. **æ–‡æ¡£åŒ–**: æµ‹è¯•æ˜¯æœ€å¥½çš„ä½¿ç”¨ç¤ºä¾‹

---

## Token æ§åˆ¶ç­–ç•¥

### äº”å±‚é˜²æŠ¤æœºåˆ¶

#### 1ï¸âƒ£ ä»»åŠ¡ç²’åº¦æ§åˆ¶
```yaml
è§„åˆ™:
  - æ¯ä¸ªä»»åŠ¡åªä¿®æ”¹ 1-2 ä¸ªæ–‡ä»¶
  - æ¯ä¸ªæ–‡ä»¶é™åˆ¶åœ¨ 200-300 è¡Œ
  - æ˜ç¡®è¾“å…¥å’Œè¾“å‡ºèŒƒå›´

Token ä¼°ç®—:
  ä»»åŠ¡æ–‡æ¡£: ~5k
  è¯»å–ä»£ç : ~6k (1-2ä¸ªæ–‡ä»¶)
  ç”Ÿæˆä»£ç : ~10k
  æµ‹è¯•è¯´æ˜: ~3k
  æ€»è®¡: ~25k tokens
```

#### 2ï¸âƒ£ è¾“å…¥æ–‡æ¡£åŒ–
```markdown
# ä»»åŠ¡æ–‡æ¡£æ¨¡æ¿

## Role
[Subagent è§’è‰²åç§°]

## Objective
[ç®€çŸ­çš„ä»»åŠ¡ç›®æ ‡ï¼Œ1-2 å¥è¯]

## Input Files
- path/to/file1.ts (line 100-150)
- path/to/file2.ts (specific function)

## Requirements
1. å…·ä½“è¦æ±‚ 1
2. å…·ä½“è¦æ±‚ 2
3. å…·ä½“è¦æ±‚ 3

## Output Location
docs/outputs/[phase]/output-[id]-[name].md

## Token Budget
é¢„è®¡ï¼š25k tokens
```

**ä¼˜åŠ¿**ï¼š
- Subagent è¯»å–æ–‡æ¡£ï¼ˆ~3k tokensï¼‰ï¼Œè€Œä¸æ˜¯åœ¨ prompt ä¸­åŒ…å«å¤§é‡ä»£ç 
- Controller åˆ›å»ºæ–‡æ¡£æ—¶å¯ä»¥ç²¾ç¡®æ§åˆ¶èŒƒå›´

#### 3ï¸âƒ£ è¾“å‡ºæ–‡æ¡£åŒ–
```markdown
# è¾“å‡ºæ–‡æ¡£æ¨¡æ¿

## Modified Files
- path/to/file1.ts
- path/to/file2.ts

## Implementation
[æ ¸å¿ƒä»£ç æ”¹åŠ¨æˆ–å®Œæ•´å®ç°]

## Testing Results
- âœ… å•å…ƒæµ‹è¯•é€šè¿‡
- âœ… é›†æˆæµ‹è¯•é€šè¿‡
- â±ï¸ æ€§èƒ½æŒ‡æ ‡

## Usage
[ä»£ç ä½¿ç”¨ç¤ºä¾‹]

## Next Steps
- å»ºè®® 1
- å»ºè®® 2
```

**ä¼˜åŠ¿**ï¼š
- åç»­ä»»åŠ¡åªéœ€è¯»å–è¾“å‡ºæ–‡æ¡£ï¼ˆ~5k tokensï¼‰
- é¿å…é‡æ–°æ‰§è¡Œæ‰€æœ‰å†å²æ“ä½œ
- æˆä¸ºå¯å¤ç”¨çš„çŸ¥è¯†åº“

#### 4ï¸âƒ£ å¢é‡å¼å¼€å‘
```
ä»»åŠ¡ 1a â†’ è¾“å‡º 1a (25k)
              â†“
ä»»åŠ¡ 1b (è¯»å–è¾“å‡º 1aï¼Œ5k) â†’ è¾“å‡º 1b (25k)
                                  â†“
ä»»åŠ¡ 1c (è¯»å–è¾“å‡º 1bï¼Œ5k) â†’ è¾“å‡º 1c (25k)
```

**å…³é”®**ï¼šæ¯ä¸ªæ–°ä»»åŠ¡åªè¯»å–å‰ä¸€ä¸ªçš„è¾“å‡ºæ–‡æ¡£ï¼Œä¸é‡æ–°ç”Ÿæˆ

#### 5ï¸âƒ£ å¹¶å‘æ‰§è¡Œéš”ç¦»
```
ä»»åŠ¡ 1a (Raydium)   â†’ è¾“å‡º 1a  â”€â”
ä»»åŠ¡ 1b (Orca)      â†’ è¾“å‡º 1b  â”€â”¤
ä»»åŠ¡ 1c (Monitor)   â†’ è¾“å‡º 1c  â”€â”¼â†’ Controller æ•´åˆ â†’ å†³ç­–
ä»»åŠ¡ 1d (Shadow)    â†’ è¾“å‡º 1d  â”€â”˜

æ¯ä¸ªä»»åŠ¡ç‹¬ç«‹ä¸Šä¸‹æ–‡ï¼š25k Ã— 4 = 100k tokens
```

---

## æ–‡æ¡£åŒ–å·¥ä½œæµ

### ä»»åŠ¡æ–‡æ¡£ï¼ˆTask Documentï¼‰

**ä½œç”¨**ï¼šç»™ Subagent çš„è¯¦ç»†æŒ‡ä»¤

**æ ‡å‡†æ ¼å¼**ï¼š
```markdown
# Task [ID]: [ä»»åŠ¡åç§°]

## Role
[Subagent è§’è‰²åç§°]

## Objective
[1-2 å¥è¯çš„ä»»åŠ¡ç›®æ ‡]

## Context
[å¿…è¦çš„èƒŒæ™¯ä¿¡æ¯]

## Input Files
- src/path/to/file1.ts (line 100-150)
- src/path/to/file2.ts (function: functionName)

## Requirements
1. åŠŸèƒ½è¦æ±‚ 1
2. åŠŸèƒ½è¦æ±‚ 2
3. éåŠŸèƒ½è¦æ±‚ï¼ˆæ€§èƒ½ã€å®‰å…¨ç­‰ï¼‰
4. **âš ï¸ å¿…é¡»æ·»åŠ ç»ˆç«¯è°ƒè¯•æ—¥å¿—**ï¼ˆå‡½æ•°å…¥å£ã€å‡ºå£ã€å…³é”®åˆ†æ”¯ã€é”™è¯¯å¤„ç†ï¼‰
5. **âš ï¸ å‰ç«¯ä»£ç æ—¥å¿—å¿…é¡»è¾“å‡ºåˆ°ç»ˆç«¯**ï¼ˆä¸ä»…æ˜¯æµè§ˆå™¨æ§åˆ¶å°ï¼‰

## Constraints
- ä¿æŒä¸ç°æœ‰æ¥å£å…¼å®¹
- éµå¾ªé¡¹ç›®ä»£ç è§„èŒƒ
- æ·»åŠ å¿…è¦çš„é”™è¯¯å¤„ç†
- æ‰€æœ‰æ—¥å¿—ä½¿ç”¨ç»Ÿä¸€æ ¼å¼ï¼š`[çº§åˆ«] [æ¨¡å—å] æ¶ˆæ¯å†…å®¹`

## Output Location
docs/outputs/[phase]/output-[id]-[name].md

## Token Budget
é¢„è®¡ï¼š25k tokens

## Success Criteria
- [ ] åŠŸèƒ½å®ç°å®Œæ•´
- [ ] æ‰€æœ‰å…³é”®èŠ‚ç‚¹æ·»åŠ äº†æ—¥å¿—è¾“å‡º
- [ ] è¿è¡Œé¡¹ç›®åç»ˆç«¯æ—¥å¿—æ— é”™è¯¯
- [ ] æµ‹è¯•é€šè¿‡ï¼ˆåŒ…æ‹¬ç»ˆç«¯æ—¥å¿—éªŒè¯ï¼‰
- [ ] æ–‡æ¡£å®Œå–„
```

### è¾“å‡ºæ–‡æ¡£ï¼ˆOutput Documentï¼‰

**ä½œç”¨**ï¼šSubagent å®Œæˆä»»åŠ¡åçš„äº¤ä»˜æˆæœ

**æ ‡å‡†æ ¼å¼**ï¼š
```markdown
# Output [ID]: [ä»»åŠ¡åç§°] - å®ç°æŠ¥å‘Š

## Status
âœ… å·²å®Œæˆ / âš ï¸ éƒ¨åˆ†å®Œæˆ / âŒ å¤±è´¥

## Modified Files
- src/path/to/file1.ts
- src/path/to/file2.ts

## Implementation

### æ ¸å¿ƒæ”¹åŠ¨
[å…³é”®ä»£ç ç‰‡æ®µæˆ–å®Œæ•´å®ç°]

### è®¾è®¡å†³ç­–
- å†³ç­– 1ï¼š[åŸå› ]
- å†³ç­– 2ï¼š[åŸå› ]

## Testing

### å•å…ƒæµ‹è¯•
```typescript
[æµ‹è¯•ä»£ç ]
```

### æµ‹è¯•ç»“æœ
- âœ… æµ‹è¯• A é€šè¿‡
- âœ… æµ‹è¯• B é€šè¿‡
- â±ï¸ æ€§èƒ½ï¼šå¹³å‡ 150ms

### ç»ˆç«¯æ—¥å¿—éªŒè¯
**é¡¹ç›®è¿è¡Œæµ‹è¯•**ï¼š
```bash
# è¿è¡Œå‘½ä»¤
npm run dev

# ç»ˆç«¯è¾“å‡ºï¼ˆå…³é”®æ—¥å¿—ï¼‰
[INFO] [ModuleName] Function started with params: {...}
[INFO] [ModuleName] Step 1 completed
[INFO] [ModuleName] Step 2 completed
[INFO] [ModuleName] SUCCESS - Result: {...}
```

**éªŒè¯ç»“æœ**ï¼š
- âœ… é¡¹ç›®æˆåŠŸå¯åŠ¨ï¼Œæ— å¯åŠ¨é”™è¯¯
- âœ… ç»ˆç«¯æ—¥å¿—æ—  ERROR è¾“å‡º
- âœ… æ‰€æœ‰å…³é”®æ“ä½œéƒ½æœ‰æ—¥å¿—è®°å½•
- âœ… é”™è¯¯å¤„ç†è·¯å¾„æ—¥å¿—å®Œæ•´
- âœ… å‰ç«¯æ—¥å¿—åœ¨ç»ˆç«¯å¯è§ï¼ˆéä»…æµè§ˆå™¨æ§åˆ¶å°ï¼‰
- âœ… è¿ç»­ 3 æ¬¡è¿è¡Œæ— é—®é¢˜

**æ—¥å¿—è¦†ç›–æƒ…å†µ**ï¼š
- [âœ…] å‡½æ•°å…¥å£æ—¥å¿—
- [âœ…] å…³é”®åˆ†æ”¯æ—¥å¿—
- [âœ…] å¤–éƒ¨è°ƒç”¨æ—¥å¿—ï¼ˆAPI/RPC/DBï¼‰
- [âœ…] é”™è¯¯å¤„ç†æ—¥å¿—ï¼ˆå«å †æ ˆï¼‰
- [âœ…] å‡½æ•°å‡ºå£æ—¥å¿—

## Usage

### åŸºæœ¬ç”¨æ³•
```typescript
[ä»£ç ç¤ºä¾‹]
```

### é«˜çº§ç”¨æ³•
[æ›´å¤æ‚çš„ç¤ºä¾‹]

## Dependencies
- æ–°å¢ä¾èµ–ï¼š[package@version]
- ä¾èµ–çš„å…¶ä»–æ¨¡å—ï¼š[module names]

## Next Steps
- å»ºè®® 1ï¼š[å…·ä½“æè¿°]
- å»ºè®® 2ï¼š[å…·ä½“æè¿°]

## Issues & Limitations
- å·²çŸ¥é—®é¢˜ 1
- é™åˆ¶ 1

## Token Usage
å®é™…ä½¿ç”¨ï¼š23k tokens (é¢„ç®—ï¼š25k)
```

### è¿›åº¦æ–‡æ¡£ï¼ˆProgress Documentï¼‰

**ä½œç”¨**ï¼šè·Ÿè¸ªæ•´ä¸ª Phase çš„è¿›åº¦

**æ ‡å‡†æ ¼å¼**ï¼š
```markdown
# Phase 1: Shadow Mode - è¿›åº¦è·Ÿè¸ª

## æ€»ä½“çŠ¶æ€
ğŸ”„ è¿›è¡Œä¸­ | å®Œæˆåº¦ï¼š60%

## ä»»åŠ¡ç»„ Aï¼ˆå¹¶å‘æ‰§è¡Œï¼‰

### Task 1a: Raydium ä»·æ ¼è·å–
- çŠ¶æ€ï¼šâœ… å·²å®Œæˆ
- Subagentï¼šMainnet Integration Expert
- å®Œæˆæ—¶é—´ï¼š2025-10-01
- è¾“å‡ºï¼šdocs/outputs/phase1/output-1a-raydium-implementation.md

### Task 1b: Orca ä»·æ ¼è·å–
- çŠ¶æ€ï¼šâœ… å·²å®Œæˆ
- Subagentï¼šMainnet Integration Expert
- å®Œæˆæ—¶é—´ï¼š2025-10-01
- è¾“å‡ºï¼šdocs/outputs/phase1/output-1b-orca-implementation.md

### Task 1c: ç›‘æ§æ¡†æ¶
- çŠ¶æ€ï¼šğŸ”„ è¿›è¡Œä¸­
- Subagentï¼šMonitoring Engineer
- é¢„è®¡å®Œæˆï¼š2025-10-02

### Task 1d: Shadow Mode æ‰§è¡Œå™¨
- çŠ¶æ€ï¼šğŸ“… å¾…å¼€å§‹
- Subagentï¼šTesting Architect

## å†³ç­–è®°å½•
- [2025-10-01] å†³å®šä½¿ç”¨ Helius RPC ä½œä¸ºä¸»èŠ‚ç‚¹
- [2025-10-01] ç¼“å­˜ TTL è®¾ç½®ä¸º 100ms

## é£é™©å’Œé—®é¢˜
- âš ï¸ Raydium SDK æ–‡æ¡£ä¸å®Œæ•´ï¼Œéœ€è¦æŸ¥çœ‹æºç 
- âš ï¸ RPC é€Ÿç‡é™åˆ¶éœ€è¦æ³¨æ„

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. å®Œæˆä»»åŠ¡ç»„ A çš„å‰©ä½™ä»»åŠ¡
2. å¼€å§‹ä»»åŠ¡ç»„ Bï¼ˆé£é™©è¯„ä¼°ã€ç­–ç•¥ä¼˜åŒ–ï¼‰
3. é›†æˆæ‰€æœ‰æ¨¡å—å¹¶æµ‹è¯•
```

---

## å®Œæ•´å·¥ä½œæµç¨‹

### Phase 0: MCP ç¯å¢ƒå‡†å¤‡

#### Step 1: å®‰è£…å’Œé…ç½® Sequential Thinking MCP

**è‡ªåŠ¨æ£€æŸ¥å’Œå®‰è£…æµç¨‹**ï¼š

```typescript
// 1. æ£€æŸ¥ MCP æ˜¯å¦å·²å®‰è£…
async function checkAndInstallMCP() {
  try {
    // è¯»å– MCP é…ç½®æ–‡ä»¶
    const mcpConfig = await readFile('C:/Users/53123/AppData/Roaming/Code/User/globalStorage/saoudrizwan.claude-dev/settings/cline_mcp_settings.json');
    const config = JSON.parse(mcpConfig);

    // æ£€æŸ¥ sequentialthinking æ˜¯å¦å·²é…ç½®
    if (!config.mcpServers || !config.mcpServers.sequentialthinking) {
      console.log('[INFO] Sequential Thinking MCP æœªå®‰è£…ï¼Œå¼€å§‹å®‰è£…...');

      // æ›´æ–°é…ç½®æ–‡ä»¶
      config.mcpServers = config.mcpServers || {};
      config.mcpServers.sequentialthinking = {
        "command": "npx",
        "args": ["-y", "@modelcontextprotocol/sequentialthinking"]
      };

      await writeFile('cline_mcp_settings.json', JSON.stringify(config, null, 2));
      console.log('[SUCCESS] Sequential Thinking MCP å·²å®‰è£…å¹¶é…ç½®');
    } else {
      console.log('[INFO] Sequential Thinking MCP å·²å­˜åœ¨');
    }
  } catch (error) {
    console.error('[ERROR] MCP å®‰è£…å¤±è´¥:', error);
  }
}
```

**MCP é…ç½®æ–‡ä»¶ç¤ºä¾‹**ï¼š
```json
{
  "mcpServers": {
    "sequentialthinking": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/sequentialthinking"]
    }
  }
}
```

#### Step 2: ä½¿ç”¨ MCP è¿›è¡Œä»»åŠ¡è§„åˆ’

**å·¥ä½œæµç¨‹**ï¼š
```
å¤æ‚éœ€æ±‚
  â†“
è°ƒç”¨ Sequential Thinking MCP
  â†“
MCP åˆ†æå’Œæ‹†åˆ†ä»»åŠ¡
  â†“
è¯†åˆ«ä»»åŠ¡ä¾èµ–å…³ç³»
  â†“
ç”Ÿæˆä»»åŠ¡æ‰§è¡Œè®¡åˆ’
  â†“
Controller æ ¹æ®è®¡åˆ’å¹¶å‘å¯åŠ¨ Subagent
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```typescript
// Controller ä½¿ç”¨ MCP åˆ†æä»»åŠ¡
// è¾“å…¥ï¼šå¤æ‚çš„å¼€å‘éœ€æ±‚
const requirement = "å®ç°å®Œæ•´çš„ DEX äº¤æ˜“ç³»ç»Ÿï¼ŒåŒ…æ‹¬ä»·æ ¼è·å–ã€é£é™©æ§åˆ¶ã€äº¤æ˜“æ‰§è¡Œå’Œç›‘æ§";

// MCP åˆ†æå¹¶æ‹†åˆ†ä»»åŠ¡
æ€è€ƒ 1ï¼šè¯†åˆ«ä¸»è¦æ¨¡å—
  - æ•°æ®é›†æˆæ¨¡å—ï¼ˆRaydiumã€Orcaï¼‰
  - é£é™©ç®¡ç†æ¨¡å—
  - äº¤æ˜“æ‰§è¡Œæ¨¡å—
  - ç›‘æ§å’Œå‘Šè­¦æ¨¡å—

æ€è€ƒ 2ï¼šåˆ†ææ¨¡å—é—´ä¾èµ–
  - æ•°æ®é›†æˆ â†’ ç‹¬ç«‹ï¼Œå¯å¹¶å‘
  - é£é™©ç®¡ç† â†’ ä¾èµ–æ•°æ®é›†æˆ
  - äº¤æ˜“æ‰§è¡Œ â†’ ä¾èµ–æ•°æ®é›†æˆå’Œé£é™©ç®¡ç†
  - ç›‘æ§ â†’ ç‹¬ç«‹ï¼Œå¯å¹¶å‘

æ€è€ƒ 3ï¼šåˆ’åˆ†ä»»åŠ¡æ‰¹æ¬¡
  æ‰¹æ¬¡ 1ï¼ˆå¹¶å‘ï¼‰ï¼šæ•°æ®é›†æˆ + ç›‘æ§
  æ‰¹æ¬¡ 2ï¼ˆå¹¶å‘ï¼‰ï¼šé£é™©ç®¡ç†
  æ‰¹æ¬¡ 3ï¼ˆå¹¶å‘ï¼‰ï¼šäº¤æ˜“æ‰§è¡Œ

æ€è€ƒ 4ï¼šç”Ÿæˆä»»åŠ¡æ–‡æ¡£
  - Task 1a: Raydium ä»·æ ¼è·å–
  - Task 1b: Orca ä»·æ ¼è·å–
  - Task 1c: ç›‘æ§æ¡†æ¶æ­å»º
  - Task 2a: é£é™©è¯„ä¼°å¼•æ“
  - Task 3a: äº¤æ˜“æ‰§è¡Œå™¨

// è¾“å‡ºï¼šç»“æ„åŒ–çš„ä»»åŠ¡è®¡åˆ’
```

#### Step 3: éªŒè¯ MCP åŠŸèƒ½

**éªŒè¯æ¸…å•**ï¼š
- [ ] MCP é…ç½®æ–‡ä»¶å·²æ­£ç¡®åˆ›å»º
- [ ] Sequential Thinking MCP å¯ä»¥æ­£å¸¸è°ƒç”¨
- [ ] MCP èƒ½å¤Ÿåˆ†æå¤æ‚ä»»åŠ¡
- [ ] MCP èƒ½å¤Ÿè¯†åˆ«ä»»åŠ¡ä¾èµ–å…³ç³»
- [ ] MCP èƒ½å¤Ÿç”Ÿæˆå¹¶å‘ä»»åŠ¡è®¡åˆ’

### Phase 1: å‡†å¤‡é˜¶æ®µ

#### Step 1: åˆ›å»º Subagent è§’è‰²å®šä¹‰
```bash
docs/agents/
â”œâ”€â”€ mainnet-integration-expert.md
â”œâ”€â”€ risk-management-architect.md
â”œâ”€â”€ strategy-optimizer.md
â”œâ”€â”€ transaction-specialist.md
â”œâ”€â”€ monitoring-engineer.md
â””â”€â”€ testing-architect.md
```

#### Step 2: ä»»åŠ¡åˆ†è§£
Controllerï¼ˆæˆ‘ï¼‰ä½¿ç”¨ Sequential Thinking åˆ†æé¡¹ç›®ï¼Œåˆ†è§£ä¸ºå°ä»»åŠ¡ï¼š
```
Phase 1: Shadow Mode
  â”œâ”€â”€ ä»»åŠ¡ç»„ Aï¼ˆå¹¶å‘ï¼‰
  â”‚   â”œâ”€â”€ Task 1a: Raydium ä»·æ ¼è·å–
  â”‚   â”œâ”€â”€ Task 1b: Orca ä»·æ ¼è·å–
  â”‚   â”œâ”€â”€ Task 1c: ç›‘æ§æ¡†æ¶
  â”‚   â””â”€â”€ Task 1d: Shadow æ‰§è¡Œå™¨
  â””â”€â”€ ä»»åŠ¡ç»„ Bï¼ˆä¾èµ– Aï¼‰
      â”œâ”€â”€ Task 1e: é£é™©è¯„ä¼°
      â”œâ”€â”€ Task 1f: ç­–ç•¥ä¼˜åŒ–
      â””â”€â”€ Task 1g: æ€§èƒ½æŒ‡æ ‡
```

### Phase 2: æ‰§è¡Œé˜¶æ®µ

#### Step 1: åˆ›å»ºä»»åŠ¡æ–‡æ¡£
Controller ä½¿ç”¨ Write tool åˆ›å»ºï¼š
```
docs/tasks/phase1/task-1a-raydium-price-fetch.md
docs/tasks/phase1/task-1b-orca-price-fetch.md
docs/tasks/phase1/task-1c-monitoring-setup.md
docs/tasks/phase1/task-1d-shadow-mode.md
```

#### Step 2: å¹¶å‘å¯åŠ¨ Subagent

**âš ï¸ å…³é”®åŸåˆ™ï¼šå¿…é¡»å¹¶è¡Œå¤šå¼€ Subagent è¿›è¡Œå¹¶å‘å¼€å‘**

Controller åœ¨**å•ä¸ªæ¶ˆæ¯**ä¸­ä½¿ç”¨ Task tool å¯åŠ¨ 4 ä¸ª Subagentï¼š

**å¹¶è¡Œå¼€å‘è§„åˆ™**ï¼š
1. **å¼ºåˆ¶å¹¶å‘**ï¼šæ‰€æœ‰ç‹¬ç«‹ä»»åŠ¡å¿…é¡»åœ¨åŒä¸€ä¸ªæ¶ˆæ¯ä¸­å¯åŠ¨ï¼Œä¸å…è®¸ä¸²è¡Œæ‰§è¡Œ
2. **æ— æ•°é‡é™åˆ¶**ï¼šå¹¶å‘ Subagent æ•°é‡æ— ä¸Šé™ï¼Œæ ¹æ®å®é™…ä»»åŠ¡æ•°é‡å†³å®š
3. **ä¾èµ–æ£€æŸ¥**ï¼šåªæœ‰å­˜åœ¨ä¾èµ–å…³ç³»çš„ä»»åŠ¡æ‰èƒ½ä¸²è¡Œï¼Œå…¶ä»–å¿…é¡»å¹¶å‘
4. **æ•ˆç‡ä¼˜å…ˆ**ï¼šå¹¶å‘å¼€å‘æ•ˆç‡ä¸å¹¶å‘æ•°é‡æˆæ­£æ¯”ï¼ˆN ä¸ªä»»åŠ¡ = N å€æå‡ï¼‰

**å¹¶å‘å¯åŠ¨ç¤ºä¾‹**ï¼š
```typescript
// âœ… æ­£ç¡®åšæ³•ï¼šåœ¨å•ä¸ªæ¶ˆæ¯ä¸­å¯åŠ¨æ‰€æœ‰ç‹¬ç«‹ä»»åŠ¡ï¼ˆæ— æ•°é‡é™åˆ¶ï¼‰
Controller å‘é€å•ä¸ªæ¶ˆæ¯ï¼ŒåŒ…å« N ä¸ªå¹¶å‘ Task tool è°ƒç”¨ï¼š

// å°è§„æ¨¡å¹¶å‘ï¼ˆ4 ä¸ªä»»åŠ¡ï¼‰
Task 1-4: Mainnet Expert, Monitoring Engineer, Testing Architect...
  - æ¯ä¸ªä»»åŠ¡ç‹¬ç«‹æ‰§è¡Œ
  - åŒæ—¶å¯åŠ¨ï¼ŒåŒæ—¶å®Œæˆ

// ä¸­è§„æ¨¡å¹¶å‘ï¼ˆ8 ä¸ªä»»åŠ¡ï¼‰
Task 1-8: æ•°æ®é›†æˆ Ã— 3, é£é™©ç®¡ç† Ã— 2, ç›‘æ§ Ã— 2, éƒ¨ç½² Ã— 1
  - æ‰€æœ‰ç‹¬ç«‹ä»»åŠ¡ä¸€æ¬¡æ€§å¯åŠ¨
  - æ•ˆç‡æå‡ 8 å€

// å¤§è§„æ¨¡å¹¶å‘ï¼ˆ16+ ä¸ªä»»åŠ¡ï¼‰
Task 1-16+: å¤šæ¨¡å—ã€å¤šåŠŸèƒ½å¹¶è¡Œå¼€å‘
  - å‰ç«¯ç»„ä»¶ Ã— 4
  - åç«¯ API Ã— 4
  - æ•°æ®é›†æˆ Ã— 4
  - æµ‹è¯•ç”¨ä¾‹ Ã— 4
  - æ•ˆç‡æå‡ 16+ å€

// âŒ é”™è¯¯åšæ³•ï¼šä¸²è¡Œå¯åŠ¨ç‹¬ç«‹ä»»åŠ¡
// ä¸è¦è¿™æ ·åšï¼šå¯åŠ¨ Task 1 â†’ ç­‰å¾…å®Œæˆ â†’ å¯åŠ¨ Task 2 â†’ ç­‰å¾…å®Œæˆ...
```

**Token ä½¿ç”¨**ï¼šN Ã— 25k tokens
- 4 ä¸ªä»»åŠ¡ï¼š100k tokens
- 8 ä¸ªä»»åŠ¡ï¼š200k tokens
- 16 ä¸ªä»»åŠ¡ï¼š400k tokens
- åªè¦åœ¨ 1M tokens é¢„ç®—å†…ï¼Œå¯ä»¥å¹¶å‘ä»»æ„æ•°é‡çš„ä»»åŠ¡

**å¹¶å‘æ•ˆç‡å¯¹æ¯”**ï¼š
- ä¸²è¡Œæ‰§è¡Œï¼šN ä¸ªä»»åŠ¡ Ã— æ¯ä¸ª 30 åˆ†é’Ÿ = 30N åˆ†é’Ÿ
- å¹¶å‘æ‰§è¡Œï¼šN ä¸ªä»»åŠ¡åŒæ—¶è¿›è¡Œ = 30 åˆ†é’Ÿ
- **æ•ˆç‡æå‡**ï¼šN å€ï¼ˆæ— ä¸Šé™ï¼‰

**å®é™…æ¡ˆä¾‹**ï¼š
- 4 ä¸ªä»»åŠ¡å¹¶å‘ï¼š120 åˆ†é’Ÿ â†’ 30 åˆ†é’Ÿï¼ˆ4 å€æå‡ï¼‰
- 8 ä¸ªä»»åŠ¡å¹¶å‘ï¼š240 åˆ†é’Ÿ â†’ 30 åˆ†é’Ÿï¼ˆ8 å€æå‡ï¼‰
- 16 ä¸ªä»»åŠ¡å¹¶å‘ï¼š480 åˆ†é’Ÿ â†’ 30 åˆ†é’Ÿï¼ˆ16 å€æå‡ï¼‰

**å¹¶å‘å¼€å‘å†³ç­–æµç¨‹**ï¼š
```
ä½¿ç”¨ Sequential Thinking MCP åˆ†æä»»åŠ¡ä¾èµ–ï¼š
  â†“
è¯†åˆ«å¯å¹¶å‘ä»»åŠ¡ç»„ï¼ˆæ— ä¾èµ–å…³ç³»ï¼‰
  â†“
åœ¨å•ä¸ªæ¶ˆæ¯ä¸­å¯åŠ¨æ‰€æœ‰å¹¶å‘ä»»åŠ¡
  â†“
ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
  â†“
æ”¶é›†å’Œæ•´åˆç»“æœ
  â†“
è¯†åˆ«ä¸‹ä¸€æ‰¹å¯å¹¶å‘ä»»åŠ¡
  â†“
é‡å¤å¾ªç¯
```

### Phase 3: æ•´åˆé˜¶æ®µ

#### Step 1: æ”¶é›†è¾“å‡º
Controller ä½¿ç”¨ Read tool è¯»å–æ‰€æœ‰è¾“å‡ºæ–‡æ¡£ï¼š
```
Read docs/outputs/phase1/output-1a-raydium-implementation.md
Read docs/outputs/phase1/output-1b-orca-implementation.md
Read docs/outputs/phase1/output-1c-monitoring-implementation.md
Read docs/outputs/phase1/output-1d-shadow-implementation.md
```

#### Step 2: Sequential Thinking åˆ†æ

**ä½¿ç”¨ Sequential Thinking MCP è§„åˆ’å’Œæ‹†åˆ†ä»»åŠ¡**

Controller ä½¿ç”¨ Sequential Thinking MCP åˆ†æï¼š
```
æ€è€ƒ 1ï¼šæ£€æŸ¥æ‰€æœ‰ä»»åŠ¡æ˜¯å¦æˆåŠŸå®Œæˆ
æ€è€ƒ 2ï¼šè¯„ä¼°ä»£ç è´¨é‡å’Œä¸€è‡´æ€§
æ€è€ƒ 3ï¼šè¯†åˆ«æ½œåœ¨çš„é›†æˆé—®é¢˜
æ€è€ƒ 4ï¼šå†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨
```

**MCP å®‰è£…æ£€æŸ¥å’Œä½¿ç”¨**ï¼š
```typescript
// 1. æ£€æŸ¥ sequentialthinking MCP æ˜¯å¦å·²å®‰è£…
// å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

// å®‰è£… sequentialthinking MCP
npx @modelcontextprotocol/create-server sequentialthinking

// 2. é…ç½® MCP æœåŠ¡å™¨ï¼ˆåœ¨ cline_mcp_settings.json ä¸­ï¼‰
{
  "mcpServers": {
    "sequentialthinking": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/sequentialthinking"]
    }
  }
}

// 3. ä½¿ç”¨ MCP è¿›è¡Œä»»åŠ¡è§„åˆ’
// Controller è°ƒç”¨ sequentialthinking MCP æ¥åˆ†æå’Œæ‹†åˆ†å¤æ‚ä»»åŠ¡
```

#### Step 3: æ›´æ–°è¿›åº¦æ–‡æ¡£
Controller æ›´æ–° `docs/progress/phase1-progress.md`

#### Step 4: å†³ç­–ä¸‹ä¸€æ‰¹ä»»åŠ¡
- å¦‚æœä»»åŠ¡ç»„ A å…¨éƒ¨æˆåŠŸ â†’ å¯åŠ¨ä»»åŠ¡ç»„ B
- å¦‚æœæœ‰å¤±è´¥ä»»åŠ¡ â†’ åˆ†æåŸå› ï¼Œé‡æ–°åˆ†é…
- å¦‚æœéœ€è¦è°ƒæ•´ â†’ åˆ›å»ºè¡¥å……ä»»åŠ¡

### Phase 4: è¿­ä»£

é‡å¤ Phase 2-3ï¼Œç›´åˆ°æ•´ä¸ªé¡¹ç›®å®Œæˆã€‚

---

## ä¼˜ç‚¹æ€»ç»“

### âœ… 1. Token ä½¿ç”¨é«˜æ•ˆ
- **ç²¾ç¡®æ§åˆ¶**ï¼šæ¯ä¸ªä»»åŠ¡ <30k tokensï¼Œè¿œä½äº 50% é™åˆ¶
- **æ— ç´¯ç§¯**ï¼šå¢é‡å¼å¼€å‘é¿å…ä¸Šä¸‹æ–‡è†¨èƒ€
- **æœ€ä½³æ€§èƒ½**ï¼šåœ¨ Claude çš„æœ‰æ•ˆä¸Šä¸‹æ–‡èŒƒå›´å†…ï¼ˆ60k-120kï¼‰

### âœ… 2. å¹¶å‘æ‰§è¡Œé«˜æ•ˆ
- **çœŸæ­£å¹¶å‘**ï¼šæ— é™åˆ¶çš„ Subagent åŒæ—¶å·¥ä½œ
- **äº’ä¸å¹²æ‰°**ï¼šæ¯ä¸ª Subagent æœ‰ç‹¬ç«‹ä¸Šä¸‹æ–‡çª—å£
- **æ—¶é—´èŠ‚çœ**ï¼šç›¸æ¯”ä¸²è¡Œå¼€å‘ï¼Œæ•ˆç‡æå‡ = å¹¶å‘ä»»åŠ¡æ•°ï¼ˆæ— ä¸Šé™ï¼‰
- **å¤§è§„æ¨¡å¹¶è¡Œ**ï¼šæ”¯æŒ 10+ã€20+ã€ç”šè‡³ 50+ ä»»åŠ¡åŒæ—¶æ‰§è¡Œ

### âœ… 3. çŸ¥è¯†å¯å¤ç”¨
- **è¾“å‡ºæ–‡æ¡£**ï¼šæˆä¸ºé¡¹ç›®çŸ¥è¯†åº“
- **ä»»åŠ¡æ¨¡æ¿**ï¼šç›¸ä¼¼ä»»åŠ¡å¯å¤ç”¨
- **æœ€ä½³å®è·µ**ï¼šæˆåŠŸç»éªŒæ–‡æ¡£åŒ–

### âœ… 4. è´¨é‡å¯æ§
- **ä¸“ä¸šåˆ†å·¥**ï¼šæ¯ä¸ª Subagent ä¸“æ³¨å…¶æ“…é•¿é¢†åŸŸ
- **èŒè´£å•ä¸€**ï¼šé™ä½é”™è¯¯ç‡
- **å¯è¿½æº¯**ï¼šå®Œæ•´çš„ä»»åŠ¡ â†’ è¾“å‡ºé“¾

### âœ… 5. æ˜“äºåä½œ
- **æ–‡æ¡£åŒ–**ï¼šå›¢é˜Ÿæˆå‘˜å¯æŸ¥é˜…æ‰€æœ‰ä»»åŠ¡å’Œè¾“å‡º
- **æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„æ–‡æ¡£æ ¼å¼
- **é€æ˜åº¦**ï¼šè¿›åº¦å’Œå†³ç­–å¯è§

### âœ… 6. å®¹é”™æ€§å¼º
- **éš”ç¦»å¤±è´¥**ï¼šå•ä¸ªä»»åŠ¡å¤±è´¥ä¸å½±å“å…¶ä»–
- **æ˜“äºé‡è¯•**ï¼šä»»åŠ¡æ–‡æ¡£å¯é‡æ–°æ‰§è¡Œ
- **æ¸è¿›å¼**ï¼šåˆ†é˜¶æ®µéªŒè¯

### âœ… 7. å¯æ‰©å±•æ€§
- **æ¨¡å—åŒ–**ï¼šæ–°ä»»åŠ¡éµå¾ªç›¸åŒæ¨¡å¼
- **è§’è‰²æ‰©å±•**ï¼šå¯æ·»åŠ æ–°çš„ Subagent è§’è‰²
- **é¡¹ç›®è¿ç§»**ï¼šæ–¹æ³•è®ºå¯åº”ç”¨äºå…¶ä»–é¡¹ç›®

### âœ… 8. æˆæœ¬ä¼˜åŒ–
- **ç¼“å­˜åˆ©ç”¨**ï¼šè¾“å‡ºæ–‡æ¡£å¯è¢«å¤šæ¬¡è¯»å–ï¼ˆç¼“å­˜ token ä»·æ ¼ä½ 10 å€ï¼‰
- **å‡å°‘é‡å¤**ï¼šé¿å…é‡æ–°ç”Ÿæˆå·²æœ‰å†…å®¹
- **ç²¾å‡†èŒƒå›´**ï¼šåªå¤„ç†å¿…è¦çš„ä»£ç 

---

## æœ€ä½³å®è·µ

### 6. MCP ä½¿ç”¨è§„èŒƒ ğŸ”§

#### æ ¸å¿ƒåŸåˆ™
**ä½¿ç”¨ Sequential Thinking MCP è¿›è¡Œä»»åŠ¡è§„åˆ’å’Œæ‹†åˆ†æ˜¯å¼ºåˆ¶è¦æ±‚ï¼Œå¿…é¡»åœ¨å¼€å‘å‰å®Œæˆ**

#### ä½¿ç”¨åœºæ™¯

**âœ… å¿…é¡»ä½¿ç”¨ MCP çš„åœºæ™¯**ï¼š
1. **å¤æ‚éœ€æ±‚åˆ†æ**ï¼šå½“éœ€æ±‚æ¶‰åŠå¤šä¸ªæ¨¡å—æˆ–ç³»ç»Ÿæ—¶
2. **ä»»åŠ¡æ‹†åˆ†è§„åˆ’**ï¼šåœ¨å¯åŠ¨ Subagent ä¹‹å‰è§„åˆ’ä»»åŠ¡
3. **ä¾èµ–å…³ç³»åˆ†æ**ï¼šè¯†åˆ«ä»»åŠ¡é—´çš„ä¾èµ–å…³ç³»
4. **å¹¶å‘æœºä¼šè¯†åˆ«**ï¼šæ‰¾å‡ºå¯ä»¥å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ç»„
5. **é£é™©è¯„ä¼°**ï¼šåˆ†ææ½œåœ¨çš„æŠ€æœ¯é£é™©å’Œå¤æ‚åº¦
6. **é›†æˆå†³ç­–**ï¼šè¯„ä¼°å¤šä¸ª Subagent çš„è¾“å‡ºå¹¶åšå‡ºå†³ç­–

**âŒ ä¸éœ€è¦ä½¿ç”¨ MCP çš„åœºæ™¯**ï¼š
1. **ç®€å•å•ä»»åŠ¡**ï¼šåªéœ€è¦å•ä¸ª Subagent å®Œæˆçš„ç®€å•ä»»åŠ¡
2. **ç´§æ€¥ä¿®å¤**ï¼šå¿«é€Ÿ bug ä¿®å¤ï¼Œæ— éœ€æ·±åº¦è§„åˆ’
3. **é…ç½®è°ƒæ•´**ï¼šç®€å•çš„é…ç½®æ–‡ä»¶ä¿®æ”¹

#### MCP å®‰è£…å’ŒéªŒè¯æµç¨‹

**è‡ªåŠ¨åŒ–æ£€æŸ¥**ï¼š
```typescript
// Controller åœ¨æ¯æ¬¡å¼€å§‹è§„åˆ’å‰æ‰§è¡Œ
async function ensureMCPReady() {
  // 1. è¯»å– MCP é…ç½®
  const configPath = 'C:/Users/53123/AppData/Roaming/Code/User/globalStorage/saoudrizwan.claude-dev/settings/cline_mcp_settings.json';
  const config = JSON.parse(await readFile(configPath));

  // 2. æ£€æŸ¥ sequentialthinking MCP
  if (!config.mcpServers?.sequentialthinking) {
    console.log('[WARN] Sequential Thinking MCP æœªé…ç½®ï¼Œæ­£åœ¨å®‰è£…...');

    // 3. æ·»åŠ é…ç½®
    config.mcpServers = config.mcpServers || {};
    config.mcpServers.sequentialthinking = {
      command: "npx",
      args: ["-y", "@modelcontextprotocol/sequentialthinking"]
    };

    // 4. ä¿å­˜é…ç½®
    await writeFile(configPath, JSON.stringify(config, null, 2));
    console.log('[SUCCESS] Sequential Thinking MCP å·²å®‰è£…');

    // 5. æç¤ºé‡å¯
    console.log('[INFO] è¯·é‡å¯ Claude Code ä»¥åŠ è½½ MCP');
    return false;
  }

  console.log('[INFO] Sequential Thinking MCP å·²å°±ç»ª');
  return true;
}
```

#### MCP ä½¿ç”¨å·¥ä½œæµç¨‹

**æ ‡å‡†æµç¨‹**ï¼š
```
1. æ¥æ”¶å¼€å‘éœ€æ±‚
   â†“
2. æ£€æŸ¥ MCP æ˜¯å¦å®‰è£…ï¼ˆè‡ªåŠ¨ï¼‰
   â†“
3. è°ƒç”¨ Sequential Thinking MCP
   â†“
4. MCP åˆ†æå’Œæ‹†åˆ†ä»»åŠ¡
   æ€è€ƒ 1ï¼šç†è§£éœ€æ±‚æ ¸å¿ƒ
   æ€è€ƒ 2ï¼šè¯†åˆ«å…³é”®æ¨¡å—
   æ€è€ƒ 3ï¼šåˆ†ææ¨¡å—ä¾èµ–
   æ€è€ƒ 4ï¼šåˆ’åˆ†ä»»åŠ¡æ‰¹æ¬¡
   æ€è€ƒ 5ï¼šè¯„ä¼°æŠ€æœ¯é£é™©
   â†“
5. ç”Ÿæˆä»»åŠ¡æ–‡æ¡£ï¼ˆåŸºäº MCP åˆ†æï¼‰
   â†“
6. å¹¶å‘å¯åŠ¨ Subagentï¼ˆæ ¹æ® MCP å»ºè®®ï¼‰
   â†“
7. æ”¶é›†ç»“æœåå†æ¬¡ä½¿ç”¨ MCP åˆ†æ
   â†“
8. MCP å†³ç­–ä¸‹ä¸€æ­¥è¡ŒåŠ¨
```

#### MCP åˆ†æç¤ºä¾‹

**è¾“å…¥**ï¼š
```
éœ€æ±‚ï¼šå®ç°å®Œæ•´çš„ Raydium DEX é›†æˆï¼ŒåŒ…æ‹¬ä»·æ ¼è·å–ã€æµåŠ¨æ€§æŸ¥è¯¢å’Œäº¤æ˜“æ‰§è¡Œ
```

**MCP åˆ†æè¿‡ç¨‹**ï¼š
```
æ€è€ƒ 1ï¼šç†è§£éœ€æ±‚èŒƒå›´
- æ ¸å¿ƒåŠŸèƒ½ï¼šä»·æ ¼è·å–ã€æµåŠ¨æ€§ã€äº¤æ˜“
- æŠ€æœ¯æ ˆï¼šRaydium SDKã€Solana Web3.js
- å¤æ‚åº¦ï¼šä¸­é«˜ï¼ˆæ¶‰åŠå¤šä¸ª SDK è°ƒç”¨ï¼‰

æ€è€ƒ 2ï¼šè¯†åˆ«ç‹¬ç«‹æ¨¡å—
æ¨¡å— Aï¼šä»·æ ¼è·å–æœåŠ¡
  - è¾“å…¥ï¼šä»£å¸å¯¹
  - è¾“å‡ºï¼šå®æ—¶ä»·æ ¼æ•°æ®
  - ä¾èµ–ï¼šRaydium SDKã€RPC è¿æ¥

æ¨¡å— Bï¼šæµåŠ¨æ€§æŸ¥è¯¢æœåŠ¡
  - è¾“å…¥ï¼šä»£å¸å¯¹
  - è¾“å‡ºï¼šæµåŠ¨æ€§æ± ä¿¡æ¯
  - ä¾èµ–ï¼šRaydium SDKã€RPC è¿æ¥

æ¨¡å— Cï¼šäº¤æ˜“æ‰§è¡Œå™¨
  - è¾“å…¥ï¼šäº¤æ˜“å‚æ•°
  - è¾“å‡ºï¼šäº¤æ˜“ç­¾å
  - ä¾èµ–ï¼šä»·æ ¼æœåŠ¡ã€æµåŠ¨æ€§æœåŠ¡ã€é’±åŒ…

æ€è€ƒ 3ï¼šåˆ†æä¾èµ–å…³ç³»
- æ¨¡å— A å’Œ Bï¼šç‹¬ç«‹ï¼Œå¯å¹¶å‘
- æ¨¡å— Cï¼šä¾èµ– A å’Œ Bï¼Œå¿…é¡»ç­‰å¾…

æ€è€ƒ 4ï¼šåˆ’åˆ†æ‰§è¡Œæ‰¹æ¬¡
æ‰¹æ¬¡ 1ï¼ˆå¹¶å‘ï¼‰ï¼š
  - Task 1a: å®ç°ä»·æ ¼è·å–æœåŠ¡
  - Task 1b: å®ç°æµåŠ¨æ€§æŸ¥è¯¢æœåŠ¡

æ‰¹æ¬¡ 2ï¼ˆä¾èµ–æ‰¹æ¬¡ 1ï¼‰ï¼š
  - Task 2a: å®ç°äº¤æ˜“æ‰§è¡Œå™¨

æ€è€ƒ 5ï¼šè¯„ä¼°é£é™©
- æŠ€æœ¯é£é™©ï¼šRaydium SDK API å¯èƒ½å˜åŒ–
- æ€§èƒ½é£é™©ï¼šRPC è°ƒç”¨å»¶è¿Ÿ
- å®‰å…¨é£é™©ï¼šç§é’¥ç®¡ç†

å»ºè®®ï¼š
- ä¸º SDK è°ƒç”¨æ·»åŠ é”™è¯¯å¤„ç†å’Œé‡è¯•
- ä½¿ç”¨è¿æ¥æ± ç®¡ç† RPC è¿æ¥
- äº¤æ˜“æ‰§è¡Œä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼æµ‹è¯•
```

**MCP è¾“å‡º**ï¼š
```markdown
# ä»»åŠ¡æ‰§è¡Œè®¡åˆ’

## æ‰¹æ¬¡ 1ï¼šæ•°æ®æœåŠ¡ï¼ˆå¹¶å‘ï¼‰
- Task 1a: Raydium ä»·æ ¼è·å–æœåŠ¡
  - ä¼°è®¡ï¼š25k tokens
  - æ—¶é—´ï¼š30 åˆ†é’Ÿ
  - Subagent: Mainnet Integration Expert

- Task 1b: Raydium æµåŠ¨æ€§æŸ¥è¯¢æœåŠ¡
  - ä¼°è®¡ï¼š25k tokens
  - æ—¶é—´ï¼š30 åˆ†é’Ÿ
  - Subagent: Mainnet Integration Expert

## æ‰¹æ¬¡ 2ï¼šäº¤æ˜“æ‰§è¡Œï¼ˆä¾èµ–æ‰¹æ¬¡ 1ï¼‰
- Task 2a: äº¤æ˜“æ‰§è¡Œå™¨
  - ä¼°è®¡ï¼š30k tokens
  - æ—¶é—´ï¼š40 åˆ†é’Ÿ
  - Subagent: Transaction Execution Specialist

## æ€»ä½“ä¼°ç®—
- Token é¢„ç®—ï¼š80k tokens
- æ€»æ—¶é—´ï¼š70 åˆ†é’Ÿï¼ˆå¹¶å‘ï¼‰vs 100 åˆ†é’Ÿï¼ˆä¸²è¡Œï¼‰
- æ•ˆç‡æå‡ï¼š30%
```

#### å¹¶å‘å¼€å‘å¼ºåˆ¶è§„åˆ™

**åŸºäº MCP åˆ†æçš„å¹¶å‘ç­–ç•¥**ï¼š

```typescript
// âœ… æ­£ç¡®ï¼šæ ¹æ® MCP åˆ†æç»“æœå¹¶å‘å¯åŠ¨
const mcpAnalysis = {
  batch1: [
    { task: '1a', independent: true },
    { task: '1b', independent: true }
  ],
  batch2: [
    { task: '2a', dependsOn: ['1a', '1b'] }
  ]
};

// å¯åŠ¨æ‰¹æ¬¡ 1ï¼ˆå¹¶å‘ï¼‰
Controller å‘é€å•ä¸ªæ¶ˆæ¯ï¼š
  - Task tool call 1: å¯åŠ¨ Task 1a
  - Task tool call 2: å¯åŠ¨ Task 1b

ç­‰å¾…æ‰¹æ¬¡ 1 å®Œæˆåï¼š
  - Task tool call 3: å¯åŠ¨ Task 2a

// âŒ é”™è¯¯ï¼šå¿½ç•¥ MCP åˆ†æï¼Œä¸²è¡Œæ‰§è¡Œç‹¬ç«‹ä»»åŠ¡
// ä¸è¦è¿™æ ·åšï¼š
å¯åŠ¨ Task 1a â†’ ç­‰å¾… â†’ å¯åŠ¨ Task 1b â†’ ç­‰å¾… â†’ å¯åŠ¨ Task 2a
```

#### MCP è´¨é‡æ£€æŸ¥

**MCP åˆ†æè´¨é‡æ ‡å‡†**ï¼š
- [ ] è¯†åˆ«äº†æ‰€æœ‰å…³é”®æ¨¡å—
- [ ] æ­£ç¡®åˆ†æäº†ä¾èµ–å…³ç³»
- [ ] åˆ’åˆ†äº†åˆç†çš„ä»»åŠ¡æ‰¹æ¬¡
- [ ] è¯„ä¼°äº†æŠ€æœ¯é£é™©
- [ ] ä¼°ç®—äº† Token å’Œæ—¶é—´æˆæœ¬
- [ ] æä¾›äº†å¹¶å‘æ‰§è¡Œå»ºè®®

**éªŒè¯ MCP è¾“å‡º**ï¼š
```typescript
// Controller éªŒè¯ MCP åˆ†æç»“æœ
function validateMCPAnalysis(analysis) {
  // 1. æ£€æŸ¥ä»»åŠ¡æ‹†åˆ†æ˜¯å¦åˆç†
  if (analysis.tasks.some(t => t.estimatedTokens > 40000)) {
    console.warn('[WARN] ä»»åŠ¡è¿‡å¤§ï¼Œå»ºè®®è¿›ä¸€æ­¥æ‹†åˆ†');
  }

  // 2. æ£€æŸ¥ä¾èµ–å…³ç³»æ˜¯å¦æ­£ç¡®
  const dependencyGraph = buildDependencyGraph(analysis);
  if (hasCyclicDependency(dependencyGraph)) {
    console.error('[ERROR] æ£€æµ‹åˆ°å¾ªç¯ä¾èµ–');
  }

  // 3. æ£€æŸ¥å¹¶å‘æœºä¼š
  const concurrentTasks = findConcurrentTasks(analysis);
  console.log(`[INFO] å¯å¹¶å‘ä»»åŠ¡æ•°ï¼š${concurrentTasks.length}`);

  return true;
}
```

#### å®é™…åº”ç”¨ç¤ºä¾‹

**åœºæ™¯ï¼šæ–°åŠŸèƒ½å¼€å‘**
```
1. å¼€å‘è€…éœ€æ±‚ï¼š
   "æ·»åŠ å¤š DEX ä»·æ ¼èšåˆåŠŸèƒ½ï¼Œæ”¯æŒ Raydiumã€Orcaã€Jupiter"

2. Controller è°ƒç”¨ MCPï¼š
   æ€è€ƒ 1ï¼šè¯†åˆ« 3 ä¸ªç‹¬ç«‹çš„é›†æˆä»»åŠ¡
   æ€è€ƒ 2ï¼šå‘ç°å¯ä»¥å®Œå…¨å¹¶å‘
   æ€è€ƒ 3ï¼šå»ºè®®å¹¶å‘å¯åŠ¨ 3 ä¸ª Subagent

3. Controller æ‰§è¡Œï¼š
   å•ä¸ªæ¶ˆæ¯å¯åŠ¨ 3 ä¸ª Task tool è°ƒç”¨
   - Task 1a: Raydium é›†æˆ
   - Task 1b: Orca é›†æˆ
   - Task 1c: Jupiter é›†æˆ

4. ç»“æœï¼š
   - æ—¶é—´ï¼š30 åˆ†é’Ÿï¼ˆvs ä¸²è¡Œ 90 åˆ†é’Ÿï¼‰
   - æ•ˆç‡æå‡ï¼š3 å€
```

#### æœ€ä½³å®è·µ

**âœ… æ¨èåšæ³•**ï¼š
1. **æ¯æ¬¡è§„åˆ’å‰æ£€æŸ¥ MCP**ï¼šç¡®ä¿ MCP å·²å®‰è£…å’Œé…ç½®
2. **å¤æ‚ä»»åŠ¡å¿…ç”¨ MCP**ï¼šè¶…è¿‡ 3 ä¸ªå­ä»»åŠ¡çš„å¿…é¡»ä½¿ç”¨ MCP åˆ†æ
3. **ç›¸ä¿¡ MCP åˆ†æ**ï¼šä¸¥æ ¼æŒ‰ç…§ MCP çš„å¹¶å‘å»ºè®®æ‰§è¡Œ
4. **è®°å½• MCP è¾“å‡º**ï¼šå°† MCP åˆ†æç»“æœä¿å­˜åˆ°æ–‡æ¡£
5. **éªŒè¯ MCP å»ºè®®**ï¼šæ‰§è¡Œå‰æ£€æŸ¥ä¾èµ–å…³ç³»å’Œèµ„æºä¼°ç®—

**âŒ é¿å…åšæ³•**ï¼š
1. è·³è¿‡ MCP ç›´æ¥è§„åˆ’å¤æ‚ä»»åŠ¡
2. å¿½ç•¥ MCP çš„å¹¶å‘å»ºè®®ï¼Œé‡‡ç”¨ä¸²è¡Œæ‰§è¡Œ
3. ä¸è®°å½• MCP åˆ†æè¿‡ç¨‹
4. å¯¹ MCP çš„ä¾èµ–åˆ†ææå‡ºè´¨ç–‘ä½†ä¸éªŒè¯
5. åœ¨ MCP æœªå®‰è£…æ—¶ç»§ç»­æ‰§è¡Œ

#### ç›‘æ§å’Œä¼˜åŒ–

**MCP ä½¿ç”¨æŒ‡æ ‡**ï¼š
```typescript
// è·Ÿè¸ª MCP ä½¿ç”¨æƒ…å†µ
const mcpMetrics = {
  totalAnalyses: 0,        // MCP åˆ†ææ¬¡æ•°
  tasksIdentified: 0,      // è¯†åˆ«çš„ä»»åŠ¡æ•°
  concurrentTasks: 0,      // å¹¶å‘ä»»åŠ¡æ•°
  timeSaved: 0,           // èŠ‚çœçš„æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
  tokenEfficiency: 0      // Token æ•ˆç‡æå‡ï¼ˆ%ï¼‰
};

// æ¯æ¬¡ä½¿ç”¨ MCP åæ›´æ–°æŒ‡æ ‡
function trackMCPUsage(analysis) {
  mcpMetrics.totalAnalyses++;
  mcpMetrics.tasksIdentified += analysis.tasks.length;
  mcpMetrics.concurrentTasks += analysis.concurrentGroups;

  const serialTime = analysis.tasks.reduce((sum, t) => sum + t.estimatedTime, 0);
  const parallelTime = Math.max(...analysis.batches.map(b => b.estimatedTime));
  mcpMetrics.timeSaved += (serialTime - parallelTime);
}
```

### 1. ä»»åŠ¡è®¾è®¡åŸåˆ™

#### âœ… DOï¼ˆæ¨èåšæ³•ï¼‰
- **å•ä¸€èŒè´£**ï¼šä¸€ä¸ªä»»åŠ¡åªåšä¸€ä»¶äº‹
- **æ˜ç¡®è¾¹ç•Œ**ï¼šæ¸…æ™°çš„è¾“å…¥å’Œè¾“å‡º
- **å¯æµ‹è¯•**ï¼šä»»åŠ¡å®Œæˆåå¯éªŒè¯
- **æ–‡æ¡£å…ˆè¡Œ**ï¼šå…ˆå†™ä»»åŠ¡æ–‡æ¡£ï¼Œå†å¯åŠ¨ Subagent

#### âŒ DON'Tï¼ˆé¿å…åšæ³•ï¼‰
- **ä»»åŠ¡è¿‡å¤§**ï¼šä¸€ä¸ªä»»åŠ¡ä¿®æ”¹ >3 ä¸ªæ–‡ä»¶
- **èŒè´£æ··æ‚**ï¼šä¸€ä¸ªä»»åŠ¡æ¶‰åŠå¤šä¸ªé¢†åŸŸ
- **æ¨¡ç³Šç›®æ ‡**ï¼šæ²¡æœ‰æ˜ç¡®çš„æˆåŠŸæ ‡å‡†
- **è·³è¿‡æ–‡æ¡£**ï¼šç›´æ¥åœ¨ prompt ä¸­å†™å¤§é‡ä»£ç 

### 1.1 è°ƒè¯•æ—¥å¿—è§„èŒƒ ğŸ”

#### æ ¸å¿ƒåŸåˆ™
**æ‰€æœ‰ä»£ç å¿…é¡»è¾“å‡ºç»ˆç«¯è°ƒè¯•æ—¥å¿—ï¼ŒåŒ…æ‹¬å‰ç«¯å’Œåç«¯ä»£ç **

#### æ—¥å¿—è¦æ±‚

**âœ… å¿…é¡»åšåˆ°**ï¼š
- **åç«¯æ—¥å¿—**ï¼šä½¿ç”¨ `console.log/console.error` è¾“å‡ºåˆ°ç»ˆç«¯
- **å‰ç«¯æ—¥å¿—**ï¼šä½¿ç”¨æœåŠ¡ç«¯æ—¥å¿—æˆ– Node.js æ—¥å¿—è¾“å‡ºåˆ°ç»ˆç«¯ï¼Œ**ä¸è¦åªè¾“å‡ºåˆ°æµè§ˆå™¨æ§åˆ¶å°**
- **å…³é”®èŠ‚ç‚¹**ï¼šå‡½æ•°å…¥å£ã€å‡ºå£ã€å…³é”®åˆ†æ”¯ã€é”™è¯¯å¤„ç†éƒ½è¦è®°å½•
- **ä¸Šä¸‹æ–‡ä¿¡æ¯**ï¼šåŒ…å«å¿…è¦çš„å‚æ•°å€¼ã€çŠ¶æ€ä¿¡æ¯ã€æ—¶é—´æˆ³
- **é”™è¯¯å †æ ˆ**ï¼šæ•è·å¹¶è¾“å‡ºå®Œæ•´çš„é”™è¯¯å †æ ˆä¿¡æ¯
- **åˆ†çº§è¾“å‡º**ï¼šåŒºåˆ† INFOã€WARNã€ERROR ç­‰çº§åˆ«

**æ—¥å¿—æ ¼å¼ç¤ºä¾‹**ï¼š
```typescript
// åç«¯ - Node.js/Express
console.log('[INFO] [RaydiumPriceFetcher] Fetching price for:', tokenPair);
console.error('[ERROR] [RaydiumPriceFetcher] Failed to fetch price:', error.message, error.stack);

// å‰ç«¯ - Next.js Server Component
console.log('[INFO] [PriceDisplay] Rendering price component:', { price, timestamp });

// å‰ç«¯ - API Route
export async function GET(request: Request) {
  console.log('[INFO] [API /api/price] Request received:', request.url);
  // ...
  console.log('[INFO] [API /api/price] Response:', result);
}
```

**âŒ ç¦æ­¢åšæ³•**ï¼š
- å‰ç«¯ä»£ç ä»…ä½¿ç”¨ `console.log` è¾“å‡ºåˆ°æµè§ˆå™¨æ§åˆ¶å°
- ç¼ºå°‘å…³é”®æ“ä½œçš„æ—¥å¿—è®°å½•
- æ—¥å¿—ä¿¡æ¯ä¸åŒ…å«ä¸Šä¸‹æ–‡
- åæ‰é”™è¯¯ä¸è¾“å‡ºå †æ ˆ

#### æ—¥å¿—è¦†ç›–èŒƒå›´

**å¿…é¡»è®°å½•çš„åœºæ™¯**ï¼š
1. **å‡½æ•°å…¥å£**ï¼šè®°å½•å‚æ•°å’Œè°ƒç”¨æ—¶é—´
2. **å¤–éƒ¨è°ƒç”¨**ï¼šAPI è¯·æ±‚ã€æ•°æ®åº“æŸ¥è¯¢ã€RPC è°ƒç”¨
3. **æ¡ä»¶åˆ†æ”¯**ï¼šé‡è¦çš„ if/elseã€switch åˆ†æ”¯
4. **å¾ªç¯æ“ä½œ**ï¼šæ‰¹é‡å¤„ç†çš„è¿›åº¦å’Œç»“æœ
5. **é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰ try/catch å—
6. **å¼‚æ­¥æ“ä½œ**ï¼šPromiseã€async/await çš„çŠ¶æ€
7. **çŠ¶æ€å˜æ›´**ï¼šå…³é”®æ•°æ®çš„ä¿®æ”¹

**æ—¥å¿—ç¤ºä¾‹**ï¼š
```typescript
async function fetchRaydiumPrice(tokenPair: string): Promise<PriceData | null> {
  console.log(`[INFO] [fetchRaydiumPrice] START - tokenPair: ${tokenPair}, timestamp: ${Date.now()}`);

  const maxRetries = 3;
  let attempt = 0;

  while (attempt < maxRetries) {
    attempt++;
    console.log(`[INFO] [fetchRaydiumPrice] Attempt ${attempt}/${maxRetries}`);

    try {
      const connection = new Connection(process.env.SOLANA_RPC_URL!);
      console.log(`[INFO] [fetchRaydiumPrice] Connection established to RPC`);

      const poolInfo = await this.getRaydiumPool(tokenPair);
      console.log(`[INFO] [fetchRaydiumPrice] Pool info retrieved:`, poolInfo ? 'success' : 'not found');

      if (!poolInfo) {
        throw new Error(`Pool not found for ${tokenPair}`);
      }

      const price = this.calculatePrice(poolInfo);
      console.log(`[INFO] [fetchRaydiumPrice] Price calculated: ${price}`);

      const result = {
        tokenPair,
        price,
        timestamp: Date.now(),
        source: 'raydium'
      };

      console.log(`[INFO] [fetchRaydiumPrice] SUCCESS - Result:`, JSON.stringify(result));
      return result;

    } catch (error) {
      console.error(`[ERROR] [fetchRaydiumPrice] Attempt ${attempt} failed:`, error.message);
      console.error(`[ERROR] [fetchRaydiumPrice] Stack trace:`, error.stack);

      if (attempt >= maxRetries) {
        console.error(`[ERROR] [fetchRaydiumPrice] FAILED - All ${maxRetries} attempts exhausted`);
        return null;
      }

      const delay = Math.pow(2, attempt) * 1000;
      console.log(`[INFO] [fetchRaydiumPrice] Retrying in ${delay}ms...`);
      await this.sleep(delay);
    }
  }

  console.log(`[INFO] [fetchRaydiumPrice] END - Returning null`);
  return null;
}
```

### 1.2 æµ‹è¯•éªŒè¯è§„èŒƒ âœ…

#### æ ¸å¿ƒåŸåˆ™
**æ¯æ¬¡ä»£ç å®ç°å®Œæˆåï¼Œå¿…é¡»è¿è¡Œé¡¹ç›®å¹¶æ£€æŸ¥ç»ˆç«¯æ—¥å¿—ï¼Œç¡®ä¿æ²¡æœ‰é”™è¯¯æˆ–è­¦å‘Š**

#### æµ‹è¯•æµç¨‹

**âœ… å¿…é¡»æ‰§è¡Œçš„æ­¥éª¤**ï¼š

1. **è¿è¡Œé¡¹ç›®**
   ```bash
   # åç«¯é¡¹ç›®
   npm run dev
   # æˆ–
   npm start

   # å‰ç«¯é¡¹ç›®
   npm run dev
   # æˆ–
   yarn dev
   ```

2. **è§‚å¯Ÿç»ˆç«¯æ—¥å¿—**
   - æ£€æŸ¥å¯åŠ¨è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰é”™è¯¯
   - æ£€æŸ¥æ˜¯å¦æœ‰æœªæ•è·çš„å¼‚å¸¸
   - æ£€æŸ¥æ˜¯å¦æœ‰åºŸå¼ƒ API è­¦å‘Š
   - æ£€æŸ¥æ˜¯å¦æœ‰ç±»å‹é”™è¯¯

3. **è§¦å‘ä»£ç è·¯å¾„**
   - è®¿é—®ç›¸å…³é¡µé¢æˆ– API ç«¯ç‚¹
   - è§¦å‘æ–°å®ç°çš„åŠŸèƒ½
   - éªŒè¯æ—¥å¿—è¾“å‡ºç¬¦åˆé¢„æœŸ

4. **æ£€æŸ¥æ—¥å¿—è´¨é‡**
   - ç¡®è®¤å…³é”®æ“ä½œæœ‰æ—¥å¿—è¾“å‡º
   - ç¡®è®¤æ—¥å¿—ä¿¡æ¯å®Œæ•´ï¼ˆåŒ…å«ä¸Šä¸‹æ–‡ï¼‰
   - ç¡®è®¤é”™è¯¯æœ‰å®Œæ•´å †æ ˆä¿¡æ¯
   - ç¡®è®¤æ—¥å¿—çº§åˆ«æ­£ç¡®ï¼ˆINFO/WARN/ERRORï¼‰

5. **ä¿®å¤é—®é¢˜**
   - å¦‚æœå‘ç°é”™è¯¯ï¼Œç«‹å³ä¿®å¤
   - å¦‚æœå‘ç°è­¦å‘Šï¼Œè¯„ä¼°å¹¶å¤„ç†
   - é‡æ–°è¿è¡Œæµ‹è¯•ç›´åˆ°æ²¡æœ‰é—®é¢˜

#### éªŒè¯æ¸…å•

**åœ¨æäº¤ä»£ç å‰å¿…é¡»ç¡®è®¤**ï¼š

- [ ] é¡¹ç›®èƒ½å¤ŸæˆåŠŸå¯åŠ¨ï¼Œæ— å¯åŠ¨é”™è¯¯
- [ ] ç»ˆç«¯æ—¥å¿—ä¸­æ²¡æœ‰ ERROR çº§åˆ«çš„è¾“å‡º
- [ ] ç»ˆç«¯æ—¥å¿—ä¸­æ²¡æœ‰æœªå¤„ç†çš„ Promise rejection
- [ ] æ–°åŠŸèƒ½çš„æ—¥å¿—è¾“å‡ºå®Œæ•´ä¸”æ¸…æ™°
- [ ] é”™è¯¯å¤„ç†è·¯å¾„æœ‰æ­£ç¡®çš„æ—¥å¿—è¾“å‡º
- [ ] æ²¡æœ‰å†—ä½™æˆ–åƒåœ¾æ—¥å¿—ï¼ˆå¦‚è¿‡åº¦çš„ debug ä¿¡æ¯ï¼‰
- [ ] å‰ç«¯ä»£ç çš„æ—¥å¿—åœ¨ç»ˆç«¯å¯è§ï¼ˆä¸ä»…åœ¨æµè§ˆå™¨æ§åˆ¶å°ï¼‰

#### å¸¸è§é—®é¢˜æ£€æŸ¥

**å¿…é¡»æ’æŸ¥çš„é—®é¢˜**ï¼š

1. **ç±»å‹é”™è¯¯**
   ```
   âŒ TypeError: Cannot read property 'xxx' of undefined
   âœ… æ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œæ·»åŠ å¯é€‰é“¾æˆ–é»˜è®¤å€¼
   ```

2. **å¼‚æ­¥é”™è¯¯**
   ```
   âŒ UnhandledPromiseRejectionWarning
   âœ… æ‰€æœ‰ Promise å¿…é¡»æœ‰ .catch() æˆ–åœ¨ try/catch ä¸­
   ```

3. **ç¯å¢ƒå˜é‡**
   ```
   âŒ process.env.XXX is undefined
   âœ… æ£€æŸ¥ .env æ–‡ä»¶é…ç½®ï¼Œæ·»åŠ é»˜è®¤å€¼æˆ–é”™è¯¯æç¤º
   ```

4. **ä¾èµ–ç¼ºå¤±**
   ```
   âŒ Cannot find module 'xxx'
   âœ… è¿è¡Œ npm install æˆ– yarn install
   ```

5. **ç«¯å£å ç”¨**
   ```
   âŒ EADDRINUSE: address already in use :::3000
   âœ… æ›´æ¢ç«¯å£æˆ–å…³é—­å ç”¨è¿›ç¨‹
   ```

#### æ—¥å¿—éªŒè¯ç¤ºä¾‹

**è‰¯å¥½çš„æµ‹è¯•è¾“å‡º**ï¼š
```
[INFO] [Server] Starting on port 3000...
[INFO] [Database] Connecting to MongoDB...
[INFO] [Database] Connected successfully
[INFO] [RaydiumPriceFetcher] Initializing with RPC: https://api.mainnet-beta.solana.com
[INFO] [Server] Server ready on http://localhost:3000

[INFO] [API /api/price] Request received: /api/price?pair=SOL/USDC
[INFO] [fetchRaydiumPrice] START - tokenPair: SOL/USDC, timestamp: 1696234567890
[INFO] [fetchRaydiumPrice] Attempt 1/3
[INFO] [fetchRaydiumPrice] Connection established to RPC
[INFO] [fetchRaydiumPrice] Pool info retrieved: success
[INFO] [fetchRaydiumPrice] Price calculated: 142.35
[INFO] [fetchRaydiumPrice] SUCCESS - Result: {"tokenPair":"SOL/USDC","price":142.35,"timestamp":1696234567890,"source":"raydium"}
[INFO] [API /api/price] Response: {"success":true,"data":{"price":142.35}}
```

**æœ‰é—®é¢˜çš„æµ‹è¯•è¾“å‡º**ï¼ˆéœ€è¦ä¿®å¤ï¼‰ï¼š
```
[INFO] [Server] Starting on port 3000...
[INFO] [Database] Connecting to MongoDB...
[ERROR] [Database] Connection failed: MongoNetworkError: connect ECONNREFUSED 127.0.0.1:27017
    at connectionFailureError (/app/node_modules/mongodb/lib/core/connection/connect.js:362:14)
    at Socket.<anonymous> (/app/node_modules/mongodb/lib/core/connection/connect.js:330:16)
    ...
âŒ éœ€è¦ä¿®å¤ï¼šæ£€æŸ¥ MongoDB è¿æ¥é…ç½®æˆ–å¯åŠ¨ MongoDB æœåŠ¡

[INFO] [API /api/price] Request received: /api/price?pair=SOL/USDC
[ERROR] [fetchRaydiumPrice] Attempt 1 failed: Cannot read property 'baseReserve' of null
[ERROR] [fetchRaydiumPrice] Stack trace: TypeError: Cannot read property 'baseReserve' of null
    at RaydiumPriceFetcher.calculatePrice (/app/src/fetcher.ts:45:30)
    ...
âŒ éœ€è¦ä¿®å¤ï¼šæ·»åŠ  null æ£€æŸ¥æˆ–æ”¹è¿›é”™è¯¯å¤„ç†
```

#### æŒç»­æ”¹è¿›

**è¿­ä»£å¾ªç¯**ï¼š
```
1. å®ç°ä»£ç  + æ·»åŠ æ—¥å¿—
   â†“
2. è¿è¡Œé¡¹ç›®
   â†“
3. æ£€æŸ¥ç»ˆç«¯æ—¥å¿—
   â†“
4. å‘ç°é—®é¢˜ï¼Ÿ
   â”œâ”€ æ˜¯ â†’ ä¿®å¤ä»£ç  â†’ å›åˆ°æ­¥éª¤ 2
   â””â”€ å¦ â†’ æµ‹è¯•é€šè¿‡ âœ…
```

**æˆåŠŸæ ‡å‡†**ï¼š
- è¿ç»­ 3 æ¬¡è¿è¡Œéƒ½æ²¡æœ‰é”™è¯¯
- æ‰€æœ‰åŠŸèƒ½è·¯å¾„éƒ½è¢«è§¦å‘å¹¶æœ‰æ—¥å¿—è®°å½•
- æ—¥å¿—è¾“å‡ºæ¸…æ™°ã€å®Œæ•´ã€æ˜“äºè°ƒè¯•

### 2. æ–‡æ¡£ç¼–å†™åŸåˆ™

#### ä»»åŠ¡æ–‡æ¡£
```markdown
âœ… å¥½çš„ä»»åŠ¡æ–‡æ¡£ï¼š
- ç›®æ ‡æ¸…æ™°ï¼ˆ1-2 å¥è¯ï¼‰
- è¾“å…¥æ˜ç¡®ï¼ˆå…·ä½“æ–‡ä»¶å’Œè¡Œå·ï¼‰
- è¦æ±‚å…·ä½“ï¼ˆå¯é‡åŒ–çš„æ ‡å‡†ï¼‰
- çº¦æŸæ˜ç¡®ï¼ˆå…¼å®¹æ€§ã€æ€§èƒ½ç­‰ï¼‰

âŒ å·®çš„ä»»åŠ¡æ–‡æ¡£ï¼š
- ç›®æ ‡æ¨¡ç³Šï¼ˆ"ä¼˜åŒ–ç³»ç»Ÿ"ï¼‰
- è¾“å…¥ä¸æ˜ï¼ˆ"ç›¸å…³ä»£ç "ï¼‰
- è¦æ±‚ç¬¼ç»Ÿï¼ˆ"å°½å¯èƒ½å¥½"ï¼‰
- æ— çº¦æŸï¼ˆå¯¼è‡´ä¸å…¼å®¹æ”¹åŠ¨ï¼‰
```

#### è¾“å‡ºæ–‡æ¡£
```markdown
âœ… å¥½çš„è¾“å‡ºæ–‡æ¡£ï¼š
- åŒ…å«å®Œæ•´ä»£ç æˆ–å…³é”®æ”¹åŠ¨
- æµ‹è¯•ç»“æœæ¸…æ™°
- ä½¿ç”¨ç¤ºä¾‹å®Œæ•´
- åç»­å»ºè®®å…·ä½“

âŒ å·®çš„è¾“å‡ºæ–‡æ¡£ï¼š
- åªæœ‰ä»£ç ï¼Œæ— è¯´æ˜
- æ— æµ‹è¯•ç»“æœ
- æ— ä½¿ç”¨ç¤ºä¾‹
- æ— åç»­å»ºè®®
```

### 3. Subagent è§’è‰²è®¾è®¡

#### ä¸“ä¸šåŒ–åŸåˆ™
æ¯ä¸ª Subagent åº”è¯¥ï¼š
- æœ‰æ˜ç¡®çš„ä¸“é•¿é¢†åŸŸ
- å·¥ä½œèŒƒå›´æ¸…æ™°ï¼ˆç‰¹å®šç›®å½•/æ¨¡å—ï¼‰
- ä¸é‡å èŒè´£

#### ç¤ºä¾‹
```
âœ… å¥½çš„è§’è‰²åˆ†å·¥ï¼š
- Data Integration Expert: ä¸“æ³¨ DEX æ•°æ®è·å–
- Risk Management Expert: ä¸“æ³¨é£é™©æ§åˆ¶é€»è¾‘
- Transaction Expert: ä¸“æ³¨äº¤æ˜“æ‰§è¡Œ

âŒ å·®çš„è§’è‰²åˆ†å·¥ï¼š
- General Developer: ä»€ä¹ˆéƒ½åš
- Backend Expert: èŒƒå›´è¿‡å¤§
- Helper: èŒè´£ä¸æ˜
```

### 4. Controller å†³ç­–åŸåˆ™

#### ä½¿ç”¨ Sequential Thinking
```
æ€è€ƒ 1ï¼šåˆ†æå½“å‰çŠ¶æ€
æ€è€ƒ 2ï¼šè¯†åˆ«å¯å¹¶å‘ä»»åŠ¡
æ€è€ƒ 3ï¼šæ£€æŸ¥ä¾èµ–å…³ç³»
æ€è€ƒ 4ï¼šè¯„ä¼°é£é™©
æ€è€ƒ 5ï¼šå†³å®šæ‰§è¡Œé¡ºåº
```

#### è´¨é‡æ£€æŸ¥
- æ¯ä¸ª Phase ç»“æŸåï¼Œå®¡æŸ¥æ‰€æœ‰è¾“å‡º
- è¿è¡Œé›†æˆæµ‹è¯•
- æ›´æ–°çŸ¥è¯†åº“

### 5. Token é¢„ç®—ç›‘æ§

#### é¢„é˜²æ€§æªæ–½
```
1. åˆ›å»ºä»»åŠ¡æ—¶ä¼°ç®— token
2. é™åˆ¶æ–‡ä»¶æ•°é‡ï¼ˆ1-2 ä¸ªï¼‰
3. é™åˆ¶æ–‡ä»¶å¤§å°ï¼ˆ200-300 è¡Œï¼‰
4. ä½¿ç”¨æ–‡æ¡£å¼•ç”¨è€Œéå¤åˆ¶ä»£ç 
```

#### åº”å¯¹è¶…é¢„ç®—
```
å¦‚æœä»»åŠ¡é¢„è®¡ >40k tokensï¼š
  â†’ æ‹†åˆ†ä¸º 2-3 ä¸ªå°ä»»åŠ¡
  â†’ ä½¿ç”¨æ›´ç²¾ç»†çš„æ–‡ä»¶èŒƒå›´
  â†’ å‡å°‘èƒŒæ™¯ä¿¡æ¯
```

---

## TDD ä¸ Subagent æ–¹æ³•è®ºæ•´åˆ

### æ•´åˆä¼˜åŠ¿

å°† TDD å·¥ä½œæµç¨‹ä¸ Subagent å¹¶å‘å¼€å‘ç›¸ç»“åˆï¼Œå¯ä»¥è·å¾—ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **è´¨é‡ä¿è¯**ï¼šTDD ç¡®ä¿æ¯ä¸ªåŠŸèƒ½éƒ½æœ‰æµ‹è¯•è¦†ç›–
2. **å¹¶å‘å¼€å‘**ï¼šå¤šä¸ªåŠŸèƒ½çš„ TDD å¾ªç¯å¯ä»¥å¹¶å‘è¿›è¡Œ
3. **æ¸è¿›å¼äº¤ä»˜**ï¼šæ¯ä¸ª TDD å¾ªç¯éƒ½æ˜¯ä¸€ä¸ªå¯äº¤ä»˜çš„å¢é‡
4. **æ–‡æ¡£åŒ–**ï¼šæ¯ä¸ªé˜¶æ®µéƒ½æœ‰è¯¦ç»†çš„æ–‡æ¡£è®°å½•

### å®é™…å·¥ä½œæµç¨‹

#### åœºæ™¯ï¼šå®ç° 4 ä¸ªç‹¬ç«‹çš„æ•°æ®è·å–åŠŸèƒ½

```
Controller åˆ†æå’Œè§„åˆ’
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚        â”‚        â”‚
åŠŸèƒ½ A            åŠŸèƒ½ B   åŠŸèƒ½ C   åŠŸèƒ½ D
Raydiumä»·æ ¼      Orcaä»·æ ¼  ç›‘æ§    Shadowæ¨¡å¼
â”‚                 â”‚        â”‚        â”‚
â”œâ”€ RED ğŸ”´        â”œâ”€ RED    â”œâ”€ RED   â”œâ”€ RED
â”‚  â†“             â”‚  â†“      â”‚  â†“     â”‚  â†“
â”œâ”€ GREEN ğŸŸ¢      â”œâ”€ GREEN  â”œâ”€ GREEN â”œâ”€ GREEN
â”‚  â†“             â”‚  â†“      â”‚  â†“     â”‚  â†“
â””â”€ REFACTOR ğŸ”§   â””â”€ REFAC  â””â”€ REFAC â””â”€ REFAC
         â”‚                 â”‚        â”‚        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
         Controller æ•´åˆå’ŒéªŒè¯
```

#### å¹¶å‘æ‰§è¡Œç­–ç•¥

**ç¬¬ä¸€è½®ï¼šRED é˜¶æ®µå¹¶å‘**

Controller åˆ›å»º 4 ä¸ª RED ä»»åŠ¡æ–‡æ¡£ï¼Œå¹¶å‘å¯åŠ¨ 4 ä¸ª TDD Red-Phase Specialistï¼š

```markdown
ä»»åŠ¡ 1a: Raydium ä»·æ ¼è·å– - RED
ä»»åŠ¡ 1b: Orca ä»·æ ¼è·å– - RED
ä»»åŠ¡ 1c: ç›‘æ§æ¡†æ¶ - RED
ä»»åŠ¡ 1d: Shadow æ¨¡å¼æ‰§è¡Œå™¨ - RED

å¹¶å‘æ‰§è¡Œï¼š4 Ã— 23k tokens = 92k tokens
```

æ‰€æœ‰ Subagent å®Œæˆåï¼ŒController æ”¶é›†è¾“å‡ºï¼š
- 4 ä¸ªæµ‹è¯•æ–‡ä»¶
- 4 ä¸ª RED é˜¶æ®µè¾“å‡ºæ–‡æ¡£
- æ‰€æœ‰æµ‹è¯•éƒ½æ˜¯å¤±è´¥çŠ¶æ€ï¼ˆç¬¦åˆé¢„æœŸï¼‰

**ç¬¬äºŒè½®ï¼šGREEN é˜¶æ®µå¹¶å‘**

Controller åˆ›å»º 4 ä¸ª GREEN ä»»åŠ¡æ–‡æ¡£ï¼Œå¹¶å‘å¯åŠ¨ 4 ä¸ª TDD Green-Phase Developerï¼š

```markdown
ä»»åŠ¡ 1a: Raydium ä»·æ ¼è·å– - GREEN
ä»»åŠ¡ 1b: Orca ä»·æ ¼è·å– - GREEN
ä»»åŠ¡ 1c: ç›‘æ§æ¡†æ¶ - GREEN
ä»»åŠ¡ 1d: Shadow æ¨¡å¼æ‰§è¡Œå™¨ - GREEN

å¹¶å‘æ‰§è¡Œï¼š4 Ã— 23k tokens = 92k tokens
```

æ‰€æœ‰ Subagent å®Œæˆåï¼ŒController æ”¶é›†è¾“å‡ºï¼š
- 4 ä¸ªå®ç°æ–‡ä»¶
- 4 ä¸ª GREEN é˜¶æ®µè¾“å‡ºæ–‡æ¡£
- æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡ï¼ˆç»¿è‰²çŠ¶æ€ï¼‰

**ç¬¬ä¸‰è½®ï¼šREFACTOR é˜¶æ®µå¹¶å‘**

Controller åˆ›å»º 4 ä¸ª REFACTOR ä»»åŠ¡æ–‡æ¡£ï¼Œå¹¶å‘å¯åŠ¨ 4 ä¸ª TDD Refactor Specialistï¼š

```markdown
ä»»åŠ¡ 1a: Raydium ä»·æ ¼è·å– - REFACTOR
ä»»åŠ¡ 1b: Orca ä»·æ ¼è·å– - REFACTOR
ä»»åŠ¡ 1c: ç›‘æ§æ¡†æ¶ - REFACTOR
ä»»åŠ¡ 1d: Shadow æ¨¡å¼æ‰§è¡Œå™¨ - REFACTOR

å¹¶å‘æ‰§è¡Œï¼š4 Ã— 23k tokens = 92k tokens
```

æ‰€æœ‰ Subagent å®Œæˆåï¼ŒController æ”¶é›†è¾“å‡ºï¼š
- 4 ä¸ªä¼˜åŒ–åçš„å®ç°æ–‡ä»¶
- 4 ä¸ª REFACTOR é˜¶æ®µè¾“å‡ºæ–‡æ¡£
- æ‰€æœ‰æµ‹è¯•ä¾ç„¶é€šè¿‡ï¼Œä»£ç è´¨é‡æå‡

### TDD ä»»åŠ¡æ–‡æ¡£å®Œæ•´ç¤ºä¾‹

```markdown
# Task Group 1: Raydium ä»·æ ¼è·å–åŠŸèƒ½ - TDD å®Œæ•´å¾ªç¯

## Task 1a-RED: Raydium ä»·æ ¼è·å– - ç¼–å†™æµ‹è¯•

### Role
TDD Red-Phase Specialist

### Objective
ä¸º Raydium mainnet ä»·æ ¼è·å–åŠŸèƒ½ç¼–å†™å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹

### Context
- å½“å‰ç³»ç»Ÿä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
- éœ€è¦é›†æˆçœŸå®çš„ Raydium SDK
- æ”¯æŒå¸¸è§ä»£å¸å¯¹ï¼ˆSOL/USDC, SOL/USDT ç­‰ï¼‰

### Requirements
1. æµ‹è¯•æ­£å¸¸æƒ…å†µï¼šæˆåŠŸè·å–ä»·æ ¼
2. æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼šæ— æ•ˆä»£å¸å¯¹ã€ç©ºå€¼å¤„ç†
3. æµ‹è¯•å¼‚å¸¸æƒ…å†µï¼šç½‘ç»œå¤±è´¥ã€é‡è¯•æœºåˆ¶
4. æµ‹è¯•æ€§èƒ½ï¼šå»¶è¿Ÿåº” <500ms
5. æµ‹è¯•ç¼“å­˜ï¼šç›¸åŒè¯·æ±‚åº”ä½¿ç”¨ç¼“å­˜

### Output Location
docs/outputs/tdd/phase1/raydium-red.md

### Success Criteria
- [ ] è‡³å°‘ 5 ä¸ªæµ‹è¯•ç”¨ä¾‹
- [ ] è¦†ç›–æ­£å¸¸ã€è¾¹ç•Œã€å¼‚å¸¸åœºæ™¯
- [ ] æ‰€æœ‰æµ‹è¯•å¤±è´¥ï¼ˆåŠŸèƒ½æœªå®ç°ï¼‰
- [ ] æµ‹è¯•ä»£ç æ¸…æ™°å¯è¯»

---

## Task 1a-GREEN: Raydium ä»·æ ¼è·å– - å®ç°åŠŸèƒ½

### Role
TDD Green-Phase Developer

### Objective
å®ç° Raydium ä»·æ ¼è·å–åŠŸèƒ½ï¼Œè®©æ‰€æœ‰æµ‹è¯•é€šè¿‡

### Input
- æµ‹è¯•æ–‡ä»¶ï¼štests/raydium-price-fetcher.test.ts
- RED é˜¶æ®µè¾“å‡ºï¼šdocs/outputs/tdd/phase1/raydium-red.md

### Requirements
1. è®©æ‰€æœ‰æµ‹è¯•ä»çº¢è‰²å˜ä¸ºç»¿è‰²
2. ä½¿ç”¨æœ€ç®€å•çš„å®ç°æ–¹å¼
3. å…è®¸ç¡¬ç¼–ç å’Œä¸´æ—¶æ–¹æ¡ˆ
4. ä¸è¿½æ±‚å®Œç¾è®¾è®¡

### Output Location
docs/outputs/tdd/phase1/raydium-green.md

### Success Criteria
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ä»£ç ç®€å•ç›´æ¥
- [ ] æ»¡è¶³æ‰€æœ‰åŠŸèƒ½è¦æ±‚

---

## Task 1a-REFACTOR: Raydium ä»·æ ¼è·å– - ä¼˜åŒ–ä»£ç 

### Role
TDD Refactor Specialist

### Objective
ä¼˜åŒ–ä»£ç è´¨é‡ï¼Œä¿æŒæµ‹è¯•é€šè¿‡

### Input
- GREEN é˜¶æ®µè¾“å‡ºï¼šdocs/outputs/tdd/phase1/raydium-green.md
- å®ç°æ–‡ä»¶ï¼šsrc/raydium-price-fetcher.ts
- æµ‹è¯•æ–‡ä»¶ï¼štests/raydium-price-fetcher.test.ts

### Requirements
1. æ¶ˆé™¤é‡å¤ä»£ç 
2. æå–æ–¹æ³•ï¼Œæå‡å¯è¯»æ€§
3. åº”ç”¨è®¾è®¡æ¨¡å¼ï¼ˆå¦‚éœ€è¦ï¼‰
4. ä¼˜åŒ–æ€§èƒ½
5. ç¡®ä¿æ‰€æœ‰æµ‹è¯•ä¾ç„¶é€šè¿‡

### Output Location
docs/outputs/tdd/phase1/raydium-refactor.md

### Success Criteria
- [ ] ä»£ç è´¨é‡æå‡
- [ ] æ— é‡å¤ä»£ç 
- [ ] æ–¹æ³•å¹³å‡é•¿åº¦ <15 è¡Œ
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æµ‹è¯•è¦†ç›–ç‡ â‰¥90%
```

### Token ä½¿ç”¨ä¼˜åŒ–

é€šè¿‡ TDD ä¸‰é˜¶æ®µæ–¹æ³•ï¼Œæ¯ä¸ªåŠŸèƒ½çš„ token ä½¿ç”¨å¦‚ä¸‹ï¼š

```
RED é˜¶æ®µ:    ~23k tokens (æµ‹è¯•ç¼–å†™)
GREEN é˜¶æ®µ:  ~23k tokens (åŠŸèƒ½å®ç°)
REFACTOR é˜¶æ®µ: ~23k tokens (ä»£ç ä¼˜åŒ–)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡:        ~69k tokens (å•ä¸ªåŠŸèƒ½å®Œæ•´ TDD å¾ªç¯)
```

**å¹¶å‘æ‰§è¡Œ 4 ä¸ªåŠŸèƒ½**ï¼š
- RED é˜¶æ®µå¹¶å‘ï¼š   4 Ã— 23k = 92k tokens
- GREEN é˜¶æ®µå¹¶å‘ï¼š 4 Ã— 23k = 92k tokens
- REFACTOR é˜¶æ®µå¹¶å‘ï¼š4 Ã— 23k = 92k tokens

**æ€»è®¡**ï¼šçº¦ 276k tokensï¼Œåˆ† 3 è½®æ‰§è¡Œ

**ä¸²è¡Œæ‰§è¡Œå¯¹æ¯”**ï¼š
- å¦‚æœä¸²è¡Œæ‰§è¡Œï¼Œéœ€è¦ 12 æ¬¡ä»»åŠ¡ï¼ˆ4 åŠŸèƒ½ Ã— 3 é˜¶æ®µï¼‰
- æ—¶é—´æ¶ˆè€—ï¼š12 æ¬¡äº¤äº’
- å¹¶å‘æ‰§è¡Œåªéœ€ 3 æ¬¡äº¤äº’ï¼ˆæ¯ä¸ªé˜¶æ®µä¸€æ¬¡ï¼‰

**æ•ˆç‡æå‡**ï¼š**4 å€**ï¼ˆ12 æ¬¡ â†’ 3 æ¬¡ï¼‰

### å®é™…åº”ç”¨å»ºè®®

#### ä½•æ—¶ä½¿ç”¨ TDD + Subagent

**âœ… æ¨èåœºæ™¯**ï¼š
1. **æ–°åŠŸèƒ½å¼€å‘**ï¼šéœ€æ±‚æ˜ç¡®ï¼Œå¯ä»¥å…ˆå†™æµ‹è¯•
2. **Bug ä¿®å¤**ï¼šå…ˆå†™å¤ç° bug çš„æµ‹è¯•ï¼Œå†ä¿®å¤
3. **é‡æ„ä¼˜åŒ–**ï¼šå·²æœ‰æµ‹è¯•ä¿æŠ¤ï¼Œæ”¾å¿ƒé‡æ„
4. **API å¼€å‘**ï¼šæ¥å£è®¾è®¡å…ˆè¡Œï¼ŒTDD æœ€åˆé€‚
5. **å…³é”®æ¨¡å—**ï¼šé£é™©ç®¡ç†ã€äº¤æ˜“æ‰§è¡Œç­‰æ ¸å¿ƒåŠŸèƒ½

**âŒ ä¸æ¨èåœºæ™¯**ï¼š
1. **æ¢ç´¢æ€§å¼€å‘**ï¼šéœ€æ±‚ä¸æ˜ç¡®ï¼Œéš¾ä»¥å…ˆå†™æµ‹è¯•
2. **å¿«é€ŸåŸå‹**ï¼šéªŒè¯æƒ³æ³•é˜¶æ®µï¼Œæµ‹è¯•æˆæœ¬é«˜
3. **ç®€å•è„šæœ¬**ï¼šä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œæ— éœ€æµ‹è¯•
4. **UI è°ƒæ•´**ï¼šè§†è§‰æ•ˆæœéš¾ä»¥è‡ªåŠ¨åŒ–æµ‹è¯•

#### æ··åˆæ¨¡å¼

å¯¹äºå¤æ‚é¡¹ç›®ï¼Œå¯ä»¥æ··åˆä½¿ç”¨ï¼š

```
æ ¸å¿ƒåŠŸèƒ½ï¼ˆæ•°æ®é›†æˆã€é£é™©æ§åˆ¶ï¼‰
  â†’ ä½¿ç”¨ TDD + Subagentï¼ˆé«˜è´¨é‡ï¼Œæœ‰æµ‹è¯•ï¼‰

è¾…åŠ©åŠŸèƒ½ï¼ˆæ—¥å¿—ã€é…ç½®ï¼‰
  â†’ ä½¿ç”¨ä¼ ç»Ÿ Subagentï¼ˆå¿«é€Ÿå®ç°ï¼‰

åŸå‹éªŒè¯ï¼ˆæ–°ç­–ç•¥å°è¯•ï¼‰
  â†’ å¿«é€Ÿå¼€å‘ï¼ŒéªŒè¯åå† TDD é‡å†™
```

### è¿›åº¦è·Ÿè¸ªç¤ºä¾‹

```markdown
# Phase 1: Shadow Mode - TDD è¿›åº¦

## åŠŸèƒ½ A: Raydium ä»·æ ¼è·å–
- âœ… RED é˜¶æ®µå®Œæˆï¼ˆ2025-10-02 10:00ï¼‰
- âœ… GREEN é˜¶æ®µå®Œæˆï¼ˆ2025-10-02 10:30ï¼‰
- âœ… REFACTOR é˜¶æ®µå®Œæˆï¼ˆ2025-10-02 11:00ï¼‰
- ğŸ“„ è¾“å‡ºæ–‡æ¡£ï¼š
  - docs/outputs/tdd/phase1/raydium-red.md
  - docs/outputs/tdd/phase1/raydium-green.md
  - docs/outputs/tdd/phase1/raydium-refactor.md

## åŠŸèƒ½ B: Orca ä»·æ ¼è·å–
- âœ… RED é˜¶æ®µå®Œæˆ
- âœ… GREEN é˜¶æ®µå®Œæˆ
- ğŸ”„ REFACTOR é˜¶æ®µè¿›è¡Œä¸­

## åŠŸèƒ½ C: ç›‘æ§æ¡†æ¶
- âœ… RED é˜¶æ®µå®Œæˆ
- ğŸ”„ GREEN é˜¶æ®µè¿›è¡Œä¸­
- ğŸ“… REFACTOR é˜¶æ®µå¾…å¼€å§‹

## åŠŸèƒ½ D: Shadow æ¨¡å¼æ‰§è¡Œå™¨
- ğŸ”„ RED é˜¶æ®µè¿›è¡Œä¸­
- ğŸ“… GREEN é˜¶æ®µå¾…å¼€å§‹
- ğŸ“… REFACTOR é˜¶æ®µå¾…å¼€å§‹

## æ€»ä½“è¿›åº¦
- å·²å®Œæˆï¼š5/12 ä»»åŠ¡ï¼ˆ42%ï¼‰
- è¿›è¡Œä¸­ï¼š2/12 ä»»åŠ¡
- å¾…å¼€å§‹ï¼š5/12 ä»»åŠ¡
```

---

## å®é™…åº”ç”¨ç¤ºä¾‹

### æ¡ˆä¾‹ï¼šRaydium çœŸå®æ•°æ®é›†æˆï¼ˆä½¿ç”¨ TDD æ–¹æ³•ï¼‰

#### Step 1: åˆ›å»ºä»»åŠ¡æ–‡æ¡£
```markdown
# Task 1a: Raydium Mainnet ä»·æ ¼è·å–

## Role
Mainnet Data Integration Expert

## Objective
å°† market-data-rag.ts ä¸­çš„ fetchRaydiumPrice() ä»æ¨¡æ‹Ÿå®ç°æ”¹ä¸ºçœŸå® mainnet æ•°æ®è·å–

## Context
- å½“å‰å®ç°è¿”å›éšæœºä»·æ ¼ï¼ˆline 163-178ï¼‰
- éœ€è¦ä½¿ç”¨ @raydium-io/raydium-sdk
- RPC endpoint åœ¨ .env ä¸­é…ç½®

## Input Files
- src/context-engineering/rag/market-data-rag.ts (line 163-178)
- .env (SOLANA_RPC_URL)
- package.json (æ£€æŸ¥ä¾èµ–)

## Requirements
1. ä½¿ç”¨ Raydium SDK è·å–çœŸå®ä»·æ ¼
2. æ”¯æŒå¸¸è§ä»£å¸å¯¹ï¼ˆSOL/USDC, SOL/USDT ç­‰ï¼‰
3. æ·»åŠ é”™è¯¯å¤„ç†ï¼ˆç½‘ç»œå¤±è´¥ã€æ— æ•ˆä»£å¸å¯¹ï¼‰
4. æ·»åŠ é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
5. ä¿æŒæ¥å£å…¼å®¹ï¼ˆä¸æ”¹å˜å‡½æ•°ç­¾åï¼‰

## Constraints
- ä¸ä¿®æ”¹å…¶ä»–å‡½æ•°
- ä¿æŒ async/await æ¨¡å¼
- å»¶è¿Ÿåº” <500ms

## Output Location
docs/outputs/phase1/output-1a-raydium-implementation.md

## Token Budget
é¢„è®¡ï¼š25k tokens

## Success Criteria
- [ ] èƒ½æˆåŠŸè·å– SOL/USDC ä»·æ ¼
- [ ] é”™è¯¯å¤„ç†è¦†ç›–æ‰€æœ‰å¼‚å¸¸
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
```

#### Step 2: å¯åŠ¨ Subagent
Controller ä½¿ç”¨ Task toolï¼š
```
è¯·æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š

ä½ æ˜¯ Mainnet Data Integration Expertï¼Œä¸“ç²¾ Solana DEX é›†æˆã€‚

1. è¯»å–ä»»åŠ¡æ–‡æ¡£ï¼šdocs/tasks/phase1/task-1a-raydium-price-fetch.md
2. æŒ‰ç…§è¦æ±‚å®ç°åŠŸèƒ½
3. ç¼–å†™æµ‹è¯•ç”¨ä¾‹
4. å°†ç»“æœå†™å…¥ï¼šdocs/outputs/phase1/output-1a-raydium-implementation.md

ç¡®ä¿ä»£ç ç®€æ´ã€å¯ç»´æŠ¤ï¼Œå¹¶åŒ…å«å¿…è¦çš„æ³¨é‡Šã€‚
```

#### Step 3: Subagent è¾“å‡º
```markdown
# Output 1a: Raydium Mainnet ä»·æ ¼è·å– - å®ç°æŠ¥å‘Š

## Status
âœ… å·²å®Œæˆ

## Modified Files
- src/context-engineering/rag/market-data-rag.ts

## Implementation

### æ ¸å¿ƒæ”¹åŠ¨
```typescript
import { Connection, PublicKey } from '@solana/web3.js';
import { Liquidity } from '@raydium-io/raydium-sdk';

private async fetchRaydiumPrice(tokenPair: string): Promise<PriceData | null> {
  const maxRetries = 3;
  let attempt = 0;

  while (attempt < maxRetries) {
    try {
      const connection = new Connection(process.env.SOLANA_RPC_URL!);
      const [tokenA, tokenB] = tokenPair.split('/');

      // æŸ¥è¯¢ Raydium pool
      const poolInfo = await this.getRaydiumPool(tokenA, tokenB);
      if (!poolInfo) {
        throw new Error(`Pool not found for ${tokenPair}`);
      }

      // è®¡ç®—ä»·æ ¼
      const price = poolInfo.baseReserve.toNumber() / poolInfo.quoteReserve.toNumber();

      return {
        tokenA,
        tokenB,
        price,
        volume24h: poolInfo.volume24h,
        liquidity: poolInfo.liquidity,
        timestamp: Date.now(),
        source: 'raydium'
      };

    } catch (error) {
      attempt++;
      if (attempt >= maxRetries) {
        console.error(`Failed to fetch Raydium price after ${maxRetries} attempts:`, error);
        return null;
      }
      // æŒ‡æ•°é€€é¿
      await this.sleep(Math.pow(2, attempt) * 1000);
    }
  }

  return null;
}

private async getRaydiumPool(tokenA: string, tokenB: string) {
  // å®ç°æ± å­æŸ¥è¯¢é€»è¾‘
  // ...
}
```

### è®¾è®¡å†³ç­–
- **é‡è¯•æœºåˆ¶**ï¼šä½¿ç”¨æŒ‡æ•°é€€é¿ï¼ˆ1s, 2s, 4sï¼‰é¿å…é¢‘ç¹è¯·æ±‚
- **é”™è¯¯å¤„ç†**ï¼šè¿”å› null è€ŒéæŠ›å‡ºå¼‚å¸¸ï¼Œä¿æŒä¸åŸæ¥å£å…¼å®¹
- **ç¼“å­˜å‹å¥½**ï¼šä¸åœ¨å‡½æ•°å†…éƒ¨ç¼“å­˜ï¼Œç”±ä¸Šå±‚ retrievePriceData å¤„ç†

## Testing

### å•å…ƒæµ‹è¯•
```typescript
describe('fetchRaydiumPrice', () => {
  it('should fetch SOL/USDC price', async () => {
    const price = await rag.fetchRaydiumPrice('SOL/USDC');
    expect(price).toBeDefined();
    expect(price.source).toBe('raydium');
    expect(price.price).toBeGreaterThan(0);
  });

  it('should handle invalid token pair', async () => {
    const price = await rag.fetchRaydiumPrice('INVALID/PAIR');
    expect(price).toBeNull();
  });

  it('should retry on network error', async () => {
    // Mock network failure then success
    // ...
  });
});
```

### æµ‹è¯•ç»“æœ
- âœ… SOL/USDC ä»·æ ¼è·å–æˆåŠŸï¼š$142.35
- âœ… SOL/USDT ä»·æ ¼è·å–æˆåŠŸï¼š$142.28
- âœ… æ— æ•ˆä»£å¸å¯¹æ­£ç¡®è¿”å› null
- âœ… é‡è¯•æœºåˆ¶éªŒè¯é€šè¿‡
- â±ï¸ å¹³å‡å»¶è¿Ÿï¼š187msï¼ˆç¬¦åˆ <500ms è¦æ±‚ï¼‰

## Usage

### åŸºæœ¬ç”¨æ³•
```typescript
const rag = new MarketDataRAG(process.env.SOLANA_RPC_URL!);
const price = await rag.fetchRaydiumPrice('SOL/USDC');
console.log(price?.price); // 142.35
```

## Dependencies
- å·²æœ‰ï¼š@raydium-io/raydium-sdk@1.3.1-beta.58 âœ…
- å·²æœ‰ï¼š@solana/web3.js@1.98.4 âœ…

## Next Steps
- å»ºè®®ï¼šæ·»åŠ å¯¹æ›´å¤šä»£å¸å¯¹çš„æ”¯æŒï¼ˆå½“å‰åªæ”¯æŒä¸»æµä»£å¸ï¼‰
- å»ºè®®ï¼šè€ƒè™‘ä½¿ç”¨ WebSocket è®¢é˜…å®æ—¶ä»·æ ¼æ›´æ–°
- å»ºè®®ï¼šæ·»åŠ ä»·æ ¼åˆç†æ€§æ£€æŸ¥ï¼ˆé˜²æ­¢å¼‚å¸¸æ•°æ®ï¼‰

## Issues & Limitations
- å½“å‰ä¾èµ– Raydium SDK çš„ APIï¼Œå¦‚æœ SDK æ›´æ–°å¯èƒ½éœ€è¦è°ƒæ•´
- æŸäº›å°ä¼—ä»£å¸å¯¹å¯èƒ½æ²¡æœ‰å¯¹åº”çš„ pool

## Token Usage
å®é™…ä½¿ç”¨ï¼š23k tokens (é¢„ç®—ï¼š25k tokens) âœ…
```

#### Step 4: Controller æ•´åˆ
Controller è¯»å–è¾“å‡ºæ–‡æ¡£ï¼Œä½¿ç”¨ Sequential Thinking åˆ†æï¼š
```
æ€è€ƒ 1ï¼šä»»åŠ¡å®Œæˆè´¨é‡å¦‚ä½•ï¼Ÿ
  â†’ ä»£ç å®ç°å®Œæ•´ï¼Œæµ‹è¯•å……åˆ†ï¼Œå»¶è¿Ÿç¬¦åˆè¦æ±‚

æ€è€ƒ 2ï¼šæ˜¯å¦æœ‰éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Ÿ
  â†’ å»ºè®®ä¸­æåˆ°çš„ WebSocket è®¢é˜…å¯ä»¥ä½œä¸ºåç»­ä¼˜åŒ–ä»»åŠ¡

æ€è€ƒ 3ï¼šæ˜¯å¦å¯ä»¥å¯åŠ¨ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Ÿ
  â†’ å¯ä»¥ï¼ŒTask 1b (Orca) ä¸ Task 1a ç‹¬ç«‹ï¼Œå¯å¹¶å‘æ‰§è¡Œ

æ€è€ƒ 4ï¼šæ˜¯å¦éœ€è¦åˆ›å»ºæ–°ä»»åŠ¡ï¼Ÿ
  â†’ å¯ä»¥å°†"WebSocket å®æ—¶è®¢é˜…"ä½œä¸º Phase 2 çš„ä¼˜åŒ–ä»»åŠ¡

å†³ç­–ï¼š
  âœ… Task 1a æˆåŠŸå®Œæˆ
  âœ… å¯ä»¥å¹¶å‘å¯åŠ¨ Task 1b, 1c, 1d
  ğŸ“ è®°å½•å»ºè®®åˆ°çŸ¥è¯†åº“
```

---

## æ€»ç»“

### æ ¸å¿ƒä»·å€¼

è¿™å¥—æ–¹æ³•è®ºçš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š

1. **å·¥ç¨‹åŒ– AI åä½œ**ï¼šå°† AI è¾…åŠ©å¼€å‘ä»"å¯¹è¯å¼ç¼–ç¨‹"æå‡åˆ°"å·¥ç¨‹åŒ–æµç¨‹"
2. **çŸ¥è¯†èµ„äº§åŒ–**ï¼šæ¯ä¸ªä»»åŠ¡çš„è¾“å‡ºæˆä¸ºå¯å¤ç”¨çš„çŸ¥è¯†èµ„äº§
3. **è§„æ¨¡åŒ–èƒ½åŠ›**ï¼šæ”¯æŒå¤§å‹å¤æ‚é¡¹ç›®çš„ç³»ç»ŸåŒ–å¼€å‘
4. **è´¨é‡å¯æ§**ï¼šé€šè¿‡ä¸“ä¸šåˆ†å·¥å’Œæ–‡æ¡£åŒ–ä¿è¯è´¨é‡

### é€‚ç”¨åœºæ™¯

- âœ… å¤§å‹é¡¹ç›®ï¼ˆ>10 ä¸ªæ¨¡å—ï¼‰
- âœ… å¤æ‚æ¶æ„ï¼ˆå¾®æœåŠ¡ã€å¤šå±‚æ¬¡ï¼‰
- âœ… é•¿æœŸç»´æŠ¤ï¼ˆéœ€è¦çŸ¥è¯†ç§¯ç´¯ï¼‰
- âœ… å›¢é˜Ÿåä½œï¼ˆéœ€è¦æ–‡æ¡£åŒ–ï¼‰

### æœªæ¥å±•æœ›

éšç€ AI èƒ½åŠ›çš„æå‡ï¼Œè¿™å¥—æ–¹æ³•è®ºå¯ä»¥è¿›ä¸€æ­¥æ¼”åŒ–ï¼š

1. **è‡ªåŠ¨åŒ–å·¥ä½œæµ**ï¼šè‡ªåŠ¨ç”Ÿæˆä»»åŠ¡æ–‡æ¡£å’Œè¿›åº¦è·Ÿè¸ª
2. **æ™ºèƒ½ä»»åŠ¡åˆ†è§£**ï¼šAI è‡ªåŠ¨è¯†åˆ«ä¾èµ–å…³ç³»å’Œå¹¶å‘æœºä¼š
3. **è´¨é‡è‡ªåŠ¨æ£€æŸ¥**ï¼šAI è‡ªåŠ¨å®¡æŸ¥ä»£ç è´¨é‡å’Œä¸€è‡´æ€§
4. **çŸ¥è¯†å›¾è°±æ„å»º**ï¼šè‡ªåŠ¨å»ºç«‹ä»»åŠ¡ã€ä»£ç ã€çŸ¥è¯†ä¹‹é—´çš„å…³è”

---

## å‚è€ƒèµ„æ–™

### ç†è®ºåŸºç¡€
- [Anthropic: Effective Context Engineering for AI Agents](https://www.anthropic.com/engineering/effective-context-engineering-for-ai-agents)
- [Anthropic: Claude Code Best Practices](https://www.anthropic.com/engineering/claude-code-best-practices)
- [Agenta.ai: Top Techniques to Manage Context Lengths in LLMs](https://agenta.ai/blog/top-6-techniques-to-manage-context-length-in-llms)

### æŠ€æœ¯å®ç°
- [Task Decomposition in Agent Systems - Matoffo](https://matoffo.com/task-decomposition-in-agent-systems/)
- [LLM Context Management: How to Improve Performance and Lower Costs](https://eval.16x.engineer/blog/llm-context-management-guide)

### æœ€ä½³å®è·µ
- Andrej Karpathy: "The delicate art and science of filling the context window"
- Sequential Thinking MCP: Dynamic and reflective problem-solving

---

**ç‰ˆæœ¬å†å²**:
- v0.0.12 (2025-10-06): æ·»åŠ  Sequential Thinking MCP é›†æˆï¼Œå¼ºåˆ¶å¹¶è¡Œå¼€å‘è§„èŒƒ
- v0.0.11 (2025-10-06): æ·»åŠ è°ƒè¯•æ—¥å¿—è§„èŒƒå’Œæµ‹è¯•éªŒè¯è§„èŒƒï¼Œå¼ºåŒ–ä»£ç è´¨é‡æ§åˆ¶
- v0.0.10 (2025-10-02): æ•´åˆ TDD Subagent è§’è‰²å®šä¹‰åˆ°ä¸»æ–‡æ¡£ï¼Œç§»é™¤ç‹¬ç«‹è§’è‰²æ–‡ä»¶
- v0.0.9 (2025-10-02): æ·»åŠ  TDD å·¥ä½œæµç¨‹å’Œ TDD Subagent è§’è‰²å®šä¹‰
- v0.0.8 (2025-10-01): åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºäº DEX Bot é¡¹ç›®å®è·µæ€»ç»“

**ç»´æŠ¤è€…**: Claude AI + äººç±»åä½œ

**License**: MIT
